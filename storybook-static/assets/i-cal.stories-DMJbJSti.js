var I=(r,s,t)=>{if(!s.has(r))throw TypeError("Cannot "+t)};var o=(r,s,t)=>(I(r,s,"read from private field"),t?t.call(r):s.get(r)),c=(r,s,t)=>{if(s.has(r))throw TypeError("Cannot add the same private member more than once");s instanceof WeakSet?s.add(r):s.set(r,t)},h=(r,s,t,e)=>(I(r,s,"write to private field"),e?e.call(r,t):s.set(r,t),t);var n=(r,s,t)=>(I(r,s,"access private method"),t);var d,f,v,m,p,g,y,x,N,A,M,E,j,u,b;const a=class a extends HTMLElement{constructor(){super();c(this,g);c(this,x);c(this,E);c(this,u);c(this,d,void 0);c(this,f,[]);c(this,v,null);c(this,m,void 0);h(this,m,this.attachShadow({mode:"open"}))}static get observedAttributes(){return["src","events","refresh"]}connectedCallback(){console.log("connected"),this.src&&!this.events?n(this,E,j).call(this).then(()=>n(this,u,b).call(this)):n(this,u,b).call(this)}get src(){return this.getAttribute("src")}set src(t){t?this.setAttribute("src",t):this.removeAttribute("src")}get events(){var t;return(t=this.getAttribute("events"))==null?void 0:t.trim()}set events(t){t?this.setAttribute("events",t):this.removeAttribute("events")}get refresh(){var t;return o(t=a,p).call(t,this.getAttribute("refresh"))}set refresh(t){var e;t=o(e=a,p).call(e,newValue),t?this.setAttribute("refresh",newValue):this.removeAttribute("refresh")}get hasFixedEvents(){var e;const t=this.getAttribute("events");return!!(t&&((e=t.trim())==null?void 0:e.length)>0)}attributeChangedCallback(t,e,i){var l;e!==i&&(console.log("attributeChanged",{name:t,oldValue:e,newValue:i}),t==="src"&&!i&&n(this,g,y).call(this),t==="refresh"&&n(this,x,N).call(this),t==="events"&&(i&&h(this,f,n(l=a,A,M).call(l,i)),this.hasFixedEvents&&n(this,g,y).call(this)),n(this,u,b).call(this))}};d=new WeakMap,f=new WeakMap,v=new WeakMap,m=new WeakMap,p=new WeakMap,g=new WeakSet,y=function(){o(this,d)&&(clearInterval(o(this,d)),h(this,d,void 0))},x=new WeakSet,N=function(t){var e;n(this,g,y).call(this),t=o(e=a,p).call(e,t),t&&h(this,d,setInterval(()=>{n(this,E,j).call(this).then(()=>n(this,u,b).call(this))},t*1e3))},A=new WeakSet,M=function(t){const e=window.ICAL.parse(t),l=new ICAL.Component(e).getAllSubcomponents("vevent");return console.log({vevents:l}),l},E=new WeakSet,j=async function(){return await fetch(this.src).then(async t=>{var e;if(t.ok){const i=await t.text();h(this,v,Date.now()),h(this,f,n(e=a,A,M).call(e,i))}else console.error(`Failed to fetch iCal data from ${this.src}`,t.status,t.statusText)})},u=new WeakSet,b=async function(){console.log("rendering");const t=this.refresh*1e3,e=Date.now()-t;this.events&&this.events.length>0,!this.hasFixedEvents&&this.src&&o(this,v)&&o(this,v)<=e;let i=this.querySelector("template");i||(i=document.createElement("template"),i.innerHTML=`
                 <style></style>
                 <p><slot name="title"></slot></p>
                 <p><slot name="start"></slot></p>
                 <p><slot name="end"></slot></p>
                 <p><slot name="description"></slot></p>
             `);const l=i.querySelector("style");let C=null;l&&(C=l.cloneNode(!0),i.removeChild(l)),o(this,m).innerHTML=`<p>${this.hasFixedEvents?"fixed":"fetch"}</p>${C?C.outerHTML:""}${o(this,f).map(S=>{var T;const w=(T=i==null?void 0:i.content)==null?void 0:T.cloneNode(!0);return w?(["title","start","end","description"].forEach(F=>{const H=w.querySelector(`slot[name="${F}"]`);H&&(H.innerHTML=S[F])}),w.outerHTML):`<div>${S}</div>`}).join("")}<slot></slot>`,o(this,m).appendChild(clone)},c(a,A),c(a,p,t=>t&&!isNaN(parseInt(t))&&t>0?parseInt(t):0);let D=a;customElements.whenDefined("jc-cal").then(()=>{console.log("jc-cal defined")});window.addEventListener("DOMContentLoaded",()=>{const r="https://unpkg.com/ical.js/dist/ical.es5.cjs";if(!window.ICAL){console.log("loading ical.js");const s=document.createElement("script");s.src=r,document.head.appendChild(s)}customElements.define("i-cal",D)});const B={title:"i-cal"},L=()=>document.createElement("i-cal");var $,k,q;L.parameters={...L.parameters,docs:{...($=L.parameters)==null?void 0:$.docs,source:{originalSource:`() => {
  return document.createElement("i-cal");
}`,...(q=(k=L.parameters)==null?void 0:k.docs)==null?void 0:q.source}}};const z=["Default"];export{L as Default,z as __namedExportsOrder,B as default};
