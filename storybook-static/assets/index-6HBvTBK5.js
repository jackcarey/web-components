var S=Object.defineProperty;var C=s=>{throw TypeError(s)};var M=(s,e,t)=>e in s?S(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var m=(s,e,t)=>M(s,typeof e!="symbol"?e+"":e,t),x=(s,e,t)=>e.has(s)||C("Cannot "+t);var a=(s,e,t)=>(x(s,e,"read from private field"),t?t.call(s):e.get(s)),u=(s,e,t)=>e.has(s)?C("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),g=(s,e,t,c)=>(x(s,e,"write to private field"),c?c.call(s,t):e.set(s,t),t),k=(s,e,t)=>(x(s,e,"access private method"),t);var b;class E{constructor(){u(this,b,new Map)}set(e,t,c=new Set){const n=a(this,b).get(e);c=new Set([...c,...(n==null?void 0:n.subscribers)||new Set]),a(this,b).set(e,{value:t,subscribers:c});for(const i of c)i(t)}get(e){return a(this,b).get(e)}}b=new WeakMap;function L(s,e){return{name:s,initialValue:e}}class I extends Event{constructor(t,c,n){super("context-request",{bubbles:!0,composed:!0});m(this,"context");m(this,"callback");m(this,"subscribe");this.context=t,this.callback=c,this.subscribe=n}}function T(s){var e,t,A,n;return n=class extends s{constructor(){super(...arguments);u(this,t);u(this,e,new E)}connectedCallback(){var o;(o=super.connectedCallback)==null||o.call(this);const r="contexts"in this?this.contexts:{};for(const[f,p]of Object.entries(r||{}))a(this,e).set(f,p());this.addEventListener("context-request",k(this,t,A))}disconnectedCallback(){g(this,e,new E),this.removeEventListener("context-request",k(this,t,A))}updateContext(r,o){a(this,e).set(r,o)}},e=new WeakMap,t=new WeakSet,A=function(r){const{name:o,initialValue:f}=r.context,p=r.subscribe;f&&a(this,e).set(o,f);const h=a(this,e).get(o);if(h){r.stopPropagation();let w=()=>{};p&&(w=()=>{h.subscribers.delete(r.callback)},h.subscribers.add(r.callback)),r.callback(h.value,w)}},n}function y(s){var e,t;return t=class extends s{constructor(){super(...arguments);u(this,e,[])}getContext(n){let i;return this.dispatchEvent(new I(L(n),r=>{i=r})),i}connectedCallback(){var i;(i=super.connectedCallback)==null||i.call(this);const n="contexts"in this?this.contexts:{};for(const[r,o]of Object.entries(n||{})){const f=L(r);this.dispatchEvent(new I(f,(p,h)=>{o(p),h&&a(this,e).push(h)},!0))}}disconnectedCallback(){for(const n of a(this,e))n==null||n();g(this,e,[])}},e=new WeakMap,t}var l,d;class D extends T(HTMLElement){constructor(){super(...arguments);u(this,l);u(this,d);g(this,l,[]),g(this,d,{}),this.contexts={i18n:()=>a(this,d)}}static get observedAttributes(){return["name","src-template","replacement","lang","fallback","preload"]}async connectedCallback(){var t;(t=super.connectedCallback)==null||t.call(this),this.fetchI18nData()}attributeChangedCallback(t,c,n){var i,r;(i=super.attributeChangedCallback)==null||i.call(this,t,c,n),(t==="src-template"||t==="replacement")&&g(this,l,[]),t==="preload"?(r=this.preload)==null||r.forEach(o=>this.fetchI18nData(o)):this.fetchI18nData()}get srcTemplate(){return this.hasAttribute("src-template")?this.getAttribute("src-template"):null}set srcTemplate(t){t!=null&&t.length?this.setAttribute("src-template",t):this.removeAttribute("src-template")}get replacement(){const t=this.getAttribute("replacement");return t!=null&&t.length?t:"%s"}set replacement(t){t!=null&&t.length?this.setAttribute("replacement",t):this.removeAttribute("replacement")}get fallback(){return this.hasAttribute("fallback")?this.getAttribute("fallback")||"en":navigator.language||"en"}set fallback(t){t!=null&&t.length?this.setAttribute("fallback",t):this.removeAttribute("fallback")}get preload(){if(this.hasAttribute("preload")){const t=this.getAttribute("preload");return t!=null&&t.length?(t&&t.split(",").every(n=>/^[a-z]{2,3}(-[A-Z]{2})?$/.test(n.trim()))||console.warn("Invalid preload attribute format. Expected a comma-separated list of language codes."),(t==null?void 0:t.split(",").map(n=>n.trim()).filter(n=>n.length>0))||void 0):void 0}else return}set preload(t){t!=null&&t.length?this.setAttribute("preload",t):this.removeAttribute("preload")}get lang(){const t=this.getAttribute("lang");if(t!=null&&t.length)return t;{const n=(navigator.languages||[navigator.language]).filter(i=>!a(this,l).includes(i));return n.length>0?n[0]:this.fallback}}set lang(t){t!=null&&t.length?this.setAttribute("lang",t):this.removeAttribute("lang")}fetchI18nData(t){if(!this.srcTemplate)return;if(t||(t=this.lang??void 0),!t||a(this,l).includes(t)){console.warn(`Skipping fetch for language: ${t} (already failed or not specified)`);return}const c=this.srcTemplate.replace(this.replacement,t),n=i=>{console[i?"error":"warn"](`Failed to fetch i18n data for language: ${t}`,i??""),a(this,l).push(t)};fetch(c).then(i=>{if(!i.ok){n();return}return i.json()}).then(i=>{i&&(this.updateContext("i18n",{...a(this,d)??{},[t]:i}),console.log(`Successfully fetched i18n data for language: ${t}`))}).catch(n)}}l=new WeakMap,d=new WeakMap;function q(s="i18n-provider"){customElements.get(s)?console.warn(`Custom element '${s}' is already defined.`):customElements.define(s,D)}function P(s){return class extends y(s){constructor(){super(...arguments),this.translations={},this.contexts={i18n:e=>{const t=e[this.lang];t&&(this.translations=t)}}}get lang(){const e=this.getAttribute("lang");return e!=null&&e.length?e:(navigator.languages||[navigator.language])[0]||"en"}}}export{D as I18NProvider,P as I18nConsumerMixin,q as defineI18NProvider};
//# sourceMappingURL=index-6HBvTBK5.js.map
