var ee=i=>{throw TypeError(i)};var H=(i,t,e)=>t.has(i)||ee("Cannot "+e);var l=(i,t,e)=>(H(i,t,"read from private field"),e?e.call(i):t.get(i)),b=(i,t,e)=>t.has(i)?ee("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),d=(i,t,e,n)=>(H(i,t,"write to private field"),n?n.call(i,e):t.set(i,e),e),p=(i,t,e)=>(H(i,t,"access private method"),e);class L{diff(t,e,n={}){let s;typeof n=="function"?(s=n,n={}):"callback"in n&&(s=n.callback);const r=this.castInput(t,n),o=this.castInput(e,n),u=this.removeEmpty(this.tokenize(r,n)),c=this.removeEmpty(this.tokenize(o,n));return this.diffWithOptionsObj(u,c,n,s)}diffWithOptionsObj(t,e,n,s){var r;const o=m=>{if(m=this.postProcess(m,n),s){setTimeout(function(){s(m)},0);return}else return m},u=e.length,c=t.length;let a=1,h=u+c;n.maxEditLength!=null&&(h=Math.min(h,n.maxEditLength));const C=(r=n.timeout)!==null&&r!==void 0?r:1/0,f=Date.now()+C,A=[{oldPos:-1,lastComponent:void 0}];let O=this.extractCommon(A[0],e,t,0,n);if(A[0].oldPos+1>=c&&O+1>=u)return o(this.buildValues(A[0].lastComponent,e,t));let B=-1/0,R=1/0;const X=()=>{for(let m=Math.max(B,-a);m<=Math.min(R,a);m+=2){let I;const z=A[m-1],F=A[m+1];z&&(A[m-1]=void 0);let _=!1;if(F){const K=F.oldPos-m;_=F&&0<=K&&K<u}const Y=z&&z.oldPos+1<c;if(!_&&!Y){A[m]=void 0;continue}if(!Y||_&&z.oldPos<F.oldPos?I=this.addToPath(F,!0,!1,0,n):I=this.addToPath(z,!1,!0,1,n),O=this.extractCommon(I,e,t,m,n),I.oldPos+1>=c&&O+1>=u)return o(this.buildValues(I.lastComponent,e,t))||!0;A[m]=I,I.oldPos+1>=c&&(R=Math.min(R,m-1)),O+1>=u&&(B=Math.max(B,m+1))}a++};if(s)(function m(){setTimeout(function(){if(a>h||Date.now()>f)return s(void 0);X()||m()},0)})();else for(;a<=h&&Date.now()<=f;){const m=X();if(m)return m}}addToPath(t,e,n,s,r){const o=t.lastComponent;return o&&!r.oneChangePerToken&&o.added===e&&o.removed===n?{oldPos:t.oldPos+s,lastComponent:{count:o.count+1,added:e,removed:n,previousComponent:o.previousComponent}}:{oldPos:t.oldPos+s,lastComponent:{count:1,added:e,removed:n,previousComponent:o}}}extractCommon(t,e,n,s,r){const o=e.length,u=n.length;let c=t.oldPos,a=c-s,h=0;for(;a+1<o&&c+1<u&&this.equals(n[c+1],e[a+1],r);)a++,c++,h++,r.oneChangePerToken&&(t.lastComponent={count:1,previousComponent:t.lastComponent,added:!1,removed:!1});return h&&!r.oneChangePerToken&&(t.lastComponent={count:h,previousComponent:t.lastComponent,added:!1,removed:!1}),t.oldPos=c,a}equals(t,e,n){return n.comparator?n.comparator(t,e):t===e||!!n.ignoreCase&&t.toLowerCase()===e.toLowerCase()}removeEmpty(t){const e=[];for(let n=0;n<t.length;n++)t[n]&&e.push(t[n]);return e}castInput(t,e){return t}tokenize(t,e){return Array.from(t)}join(t){return t.join("")}postProcess(t,e){return t}get useLongestToken(){return!1}buildValues(t,e,n){const s=[];let r;for(;t;)s.push(t),r=t.previousComponent,delete t.previousComponent,t=r;s.reverse();const o=s.length;let u=0,c=0,a=0;for(;u<o;u++){const h=s[u];if(h.removed)h.value=this.join(n.slice(a,a+h.count)),a+=h.count;else{if(!h.added&&this.useLongestToken){let C=e.slice(c,c+h.count);C=C.map(function(f,A){const O=n[a+A];return O.length>f.length?O:f}),h.value=this.join(C)}else h.value=this.join(e.slice(c,c+h.count));c+=h.count,h.added||(a+=h.count)}}return s}}class he extends L{}const fe=new he;function ae(i,t,e){return fe.diff(i,t,e)}function te(i,t){let e;for(e=0;e<i.length&&e<t.length;e++)if(i[e]!=t[e])return i.slice(0,e);return i.slice(0,e)}function ne(i,t){let e;if(!i||!t||i[i.length-1]!=t[t.length-1])return"";for(e=0;e<i.length&&e<t.length;e++)if(i[i.length-(e+1)]!=t[t.length-(e+1)])return i.slice(-e);return i.slice(-e)}function V(i,t,e){if(i.slice(0,t.length)!=t)throw Error(`string ${JSON.stringify(i)} doesn't start with prefix ${JSON.stringify(t)}; this is a bug`);return e+i.slice(t.length)}function Z(i,t,e){if(!t)return i+e;if(i.slice(-t.length)!=t)throw Error(`string ${JSON.stringify(i)} doesn't end with suffix ${JSON.stringify(t)}; this is a bug`);return i.slice(0,-t.length)+e}function q(i,t){return V(i,t,"")}function j(i,t){return Z(i,t,"")}function ie(i,t){return t.slice(0,de(i,t))}function de(i,t){let e=0;i.length>t.length&&(e=i.length-t.length);let n=t.length;i.length<t.length&&(n=i.length);const s=Array(n);let r=0;s[0]=0;for(let o=1;o<n;o++){for(t[o]==t[r]?s[o]=s[r]:s[o]=r;r>0&&t[o]!=t[r];)r=s[r];t[o]==t[r]&&r++}r=0;for(let o=e;o<i.length;o++){for(;r>0&&i[o]!=t[r];)r=s[r];i[o]==t[r]&&r++}return r}function M(i){let t;for(t=i.length-1;t>=0&&i[t].match(/\s/);t--);return i.substring(t+1)}function D(i){const t=i.match(/^\s*/);return t?t[0]:""}const J="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",ge=new RegExp(`[${J}]+|\\s+|[^${J}]`,"ug");class me extends L{equals(t,e,n){return n.ignoreCase&&(t=t.toLowerCase(),e=e.toLowerCase()),t.trim()===e.trim()}tokenize(t,e={}){let n;if(e.intlSegmenter){const o=e.intlSegmenter;if(o.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');n=Array.from(o.segment(t),u=>u.segment)}else n=t.match(ge)||[];const s=[];let r=null;return n.forEach(o=>{/\s/.test(o)?r==null?s.push(o):s.push(s.pop()+o):r!=null&&/\s/.test(r)?s[s.length-1]==r?s.push(s.pop()+o):s.push(r+o):s.push(o),r=o}),s}join(t){return t.map((e,n)=>n==0?e:e.replace(/^\s+/,"")).join("")}postProcess(t,e){if(!t||e.oneChangePerToken)return t;let n=null,s=null,r=null;return t.forEach(o=>{o.added?s=o:o.removed?r=o:((s||r)&&se(n,r,s,o),n=o,s=null,r=null)}),(s||r)&&se(n,r,s,null),t}}const pe=new me;function oe(i,t,e){return(e==null?void 0:e.ignoreWhitespace)!=null&&!e.ignoreWhitespace?ce(i,t,e):pe.diff(i,t,e)}function se(i,t,e,n){if(t&&e){const s=D(t.value),r=M(t.value),o=D(e.value),u=M(e.value);if(i){const c=te(s,o);i.value=Z(i.value,o,c),t.value=q(t.value,c),e.value=q(e.value,c)}if(n){const c=ne(r,u);n.value=V(n.value,u,c),t.value=j(t.value,c),e.value=j(e.value,c)}}else if(e){if(i){const s=D(e.value);e.value=e.value.substring(s.length)}if(n){const s=D(n.value);n.value=n.value.substring(s.length)}}else if(i&&n){const s=D(n.value),r=D(t.value),o=M(t.value),u=te(s,r);t.value=q(t.value,u);const c=ne(q(s,u),o);t.value=j(t.value,c),n.value=V(n.value,s,c),i.value=Z(i.value,s,s.slice(0,s.length-c.length))}else if(n){const s=D(n.value),r=M(t.value),o=ie(r,s);t.value=j(t.value,o)}else if(i){const s=M(i.value),r=D(t.value),o=ie(s,r);t.value=q(t.value,o)}}class Ae extends L{tokenize(t){const e=new RegExp(`(\\r?\\n)|[${J}]+|[^\\S\\n\\r]+|[^${J}]`,"ug");return t.match(e)||[]}}const Ce=new Ae;function ce(i,t,e){return Ce.diff(i,t,e)}class ve extends L{constructor(){super(...arguments),this.tokenize=le}equals(t,e,n){return n.ignoreWhitespace?((!n.newlineIsToken||!t.includes(`
`))&&(t=t.trim()),(!n.newlineIsToken||!e.includes(`
`))&&(e=e.trim())):n.ignoreNewlineAtEof&&!n.newlineIsToken&&(t.endsWith(`
`)&&(t=t.slice(0,-1)),e.endsWith(`
`)&&(e=e.slice(0,-1))),super.equals(t,e,n)}}const be=new ve;function xe(i,t,e){return be.diff(i,t,e)}function le(i,t){t.stripTrailingCr&&(i=i.replace(/\r\n/g,`
`));const e=[],n=i.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(let s=0;s<n.length;s++){const r=n[s];s%2&&!t.newlineIsToken?e[e.length-1]+=r:e.push(r)}return e}function we(i){return i=="."||i=="!"||i=="?"}class Se extends L{tokenize(t){var e;const n=[];let s=0;for(let r=0;r<t.length;r++){if(r==t.length-1){n.push(t.slice(s));break}if(we(t[r])&&t[r+1].match(/\s/)){for(n.push(t.slice(s,r+1)),r=s=r+1;!((e=t[r+1])===null||e===void 0)&&e.match(/\s/);)r++;n.push(t.slice(s,r+1)),s=r+1}}return n}}const Ee=new Se;function Pe(i,t,e){return Ee.diff(i,t,e)}class ye extends L{tokenize(t){return t.split(/([{}:;,]|\s+)/)}}const We=new ye;function De(i,t,e){return We.diff(i,t,e)}class Le extends L{constructor(){super(...arguments),this.tokenize=le}get useLongestToken(){return!0}castInput(t,e){const{undefinedReplacement:n,stringifyReplacer:s=(r,o)=>typeof o>"u"?n:o}=e;return typeof t=="string"?t:JSON.stringify(G(t,null,null,s),null,"  ")}equals(t,e,n){return super.equals(t.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"),n)}}const Oe=new Le;function Ie(i,t,e){return Oe.diff(i,t,e)}function G(i,t,e,n,s){t=t||[],e=e||[],n&&(i=n(s===void 0?"":s,i));let r;for(r=0;r<t.length;r+=1)if(t[r]===i)return e[r];let o;if(Object.prototype.toString.call(i)==="[object Array]"){for(t.push(i),o=new Array(i.length),e.push(o),r=0;r<i.length;r+=1)o[r]=G(i[r],t,e,n,String(r));return t.pop(),e.pop(),o}if(i&&i.toJSON&&(i=i.toJSON()),typeof i=="object"&&i!==null){t.push(i),o={},e.push(o);const u=[];let c;for(c in i)Object.prototype.hasOwnProperty.call(i,c)&&u.push(c);for(u.sort(),r=0;r<u.length;r+=1)c=u[r],o[c]=G(i[c],t,e,n,c);t.pop(),e.pop()}else o=i;return o}class Ne extends L{tokenize(t){return t.slice()}join(t){return t}removeEmpty(t){return t}}const Te=new Ne;function ze(i,t,e){return Te.diff(i,t,e)}const re={word:oe,chars:ae,wordsWithSpaces:ce,lines:xe,sentences:Pe,css:De,json:Ie,arrays:ze};var E,P,v,w,S,y,N,T,g,U,W,k,ue,x;const $=class $ extends HTMLElement{constructor(){super();b(this,g);b(this,E,null);b(this,P,null);b(this,v,null);b(this,w);b(this,S);b(this,y,[]);b(this,N,null);b(this,T,null);b(this,W,e=>{const n=e.innerText,s=this.compare;if(!(s!=null&&s.length))return n;const r=s in e?e[s]:null;if(s)return r;const o=e.getAttribute(s);return o||r||o||n})}static get setupAttrs(){return["original-selector","changed-selector","original-src","changed-src","refetch"]}static get observedAttributes(){return[...["mode","ignore-case"],...$.setupAttrs,"original","changed","compare"]}get changes(){return l(this,y)}get mode(){return this.getAttribute("mode")||"word"}set mode(e){e!=null&&e.length?this.removeAttribute("mode"):this.setAttribute("mode",e)}get ignoreCase(){return this.getAttribute("ignore-case")==="true"}set ignoreCase(e){e?this.setAttribute("ignore-case",""):this.removeAttribute("ignore-case")}get original(){return this.getAttribute("original")||""}set original(e){e!=null&&e.length?this.setAttribute("original",e):this.removeAttribute("original")}get changed(){return this.getAttribute("changed")||""}set changed(e){e!=null&&e.length?this.setAttribute("changed",e):this.removeAttribute("changed")}get originalSelector(){return this.getAttribute("original-selector")||""}set originalSelector(e){e!=null&&e.length?this.setAttribute("original-selector",e):this.removeAttribute("original-selector")}get changedSelector(){return this.getAttribute("changed-selector")||""}set changedSelector(e){e!=null&&e.length?this.setAttribute("changed-selector",e):this.removeAttribute("changed-selector")}get originalSrc(){return this.getAttribute("original-src")||""}set originalSrc(e){e!=null&&e.length?this.setAttribute("original-src",e):this.removeAttribute("original-src")}get changedSrc(){return this.getAttribute("changed-src")||""}set changedSrc(e){e!=null&&e.length?this.setAttribute("changed-src",e):this.removeAttribute("changed-src")}get refetch(){const e=this.getAttribute("refetch");if(e){const n=parseInt(e,10);return isNaN(n)||n<=0?void 0:n}}set refetch(e){if(e!=null&&e.length)try{parseInt(e,10)?this.setAttribute("refetch",e):this.removeAttribute("refetch")}catch{this.removeAttribute("refetch")}else this.removeAttribute("refetch")}get compare(){return this.getAttribute("compare")}set compare(e){e!=null&&e.length?this.setAttribute("compare",e):this.removeAttribute("compare")}connectedCallback(){p(this,g,k).call(this),p(this,g,x).call(this)}disconnectedCallback(){var e,n;(e=l(this,E))==null||e.disconnect(),d(this,E,null),(n=l(this,P))==null||n.disconnect(),d(this,P,null),l(this,v)&&(clearInterval(l(this,v)),d(this,v,null))}get options(){return l(this,T)||void 0}set options(e){e?d(this,T,e):d(this,T,null),p(this,g,x).call(this)}attributeChangedCallback(e,n,s){if(e==="mode"&&(s!=null&&s.length)&&!re[s]){this.setAttribute("mode","word");return}e==="original"&&d(this,w,s),e==="changed"&&d(this,S,s),$.setupAttrs.includes(e)&&p(this,g,k).call(this),p(this,g,x).call(this)}refresh(){p(this,g,k).call(this),p(this,g,x).call(this)}};E=new WeakMap,P=new WeakMap,v=new WeakMap,w=new WeakMap,S=new WeakMap,y=new WeakMap,N=new WeakMap,T=new WeakMap,g=new WeakSet,U=function(){const e=this.getAttribute("original-src"),n=this.getAttribute("changed-src"),s=[],r=[];e&&s.push(fetch(e).then(o=>this.mode==="json"?o.json():o.text()).then(o=>{d(this,w,o)}).catch(o=>r.push(o))),n&&s.push(fetch(n).then(o=>this.mode==="json"?o.json():o.text()).then(o=>{d(this,S,o)}).catch(o=>r.push(o))),Promise.allSettled(s).then(()=>{r.length&&(console.error("Error fetching diff text sources:"),r.forEach(o=>console.error(o))),p(this,g,x).call(this)})},W=new WeakMap,k=function(){var h,C;this.disconnectedCallback();const e=!!this.getAttribute("original-src"),n=!!this.getAttribute("changed-src"),s=this.getAttribute("refetch"),r=s?parseInt(s,10):0,o=(e||n)&&!!r,u=!e&&!!this.originalSelector,c=!n&&!!this.changedSelector;(e||n)&&p(this,g,U).call(this),o&&(l(this,v)&&clearInterval(l(this,v)),l(this,v)&&(clearInterval(l(this,v)),d(this,v,null)),d(this,v,setInterval(()=>{p(this,g,U).call(this),p(this,g,x).call(this)},Math.max(1e3,r*1e3))));const a={childList:!0,subtree:!0,attributes:!0,characterData:!0};if(u&&(l(this,E)?l(this,E).disconnect():this.originalSelector&&d(this,E,new MutationObserver(()=>{const f=document.querySelector(this.originalSelector);d(this,w,l(this,W).call(this,f)),p(this,g,x).call(this)})),this.originalSelector)){const f=document.querySelector(this.originalSelector);f&&((h=l(this,E))==null||h.observe(f,a),f.addEventListener("input",()=>{d(this,w,l(this,W).call(this,f)),p(this,g,x).call(this)}),d(this,w,l(this,W).call(this,f)))}if(c&&(l(this,P)?l(this,P).disconnect():this.changedSelector&&d(this,P,new MutationObserver(()=>{console.log("changed mutation observer");const f=document.querySelector(this.changedSelector);d(this,S,l(this,W).call(this,f)),p(this,g,x).call(this)})),this.changedSelector)){const f=document.querySelector(this.changedSelector);f&&((C=l(this,P))==null||C.observe(f,a),f.addEventListener("input",()=>{d(this,S,l(this,W).call(this,f)),p(this,g,x).call(this)}),d(this,S,l(this,W).call(this,f)))}},ue=function(){var c,a,h;const e=re[this.mode]||oe,n=l(this,w),s=l(this,S),r=structuredClone(l(this,y)),o=e(n??"",s??"",{ignoreCase:!!this.ignoreCase,...this.options??{},callback:void 0}),u=o.length!==r.length||o.some((C,f)=>{const A=r[f];return!A||C.value!==A.value||C.added!==A.added||C.removed!==A.removed||C.count!==A.count});if(u){d(this,y,o),this.options&&((c=this.options)!=null&&c.callback)&&typeof((a=this.options)==null?void 0:a.callback)=="function"&&((h=this.options)==null||h.callback(l(this,y)));const C={...Object.fromEntries($.observedAttributes.map(f=>[f,this.getAttribute(f)])),options:this.options,original:l(this,w),changed:l(this,S),changes:l(this,y)};this.dispatchEvent(new CustomEvent("diff-text",{detail:C,bubbles:!0,composed:!0,cancelable:!0}))}return u},x=function(){l(this,N)&&cancelAnimationFrame(l(this,N)),d(this,N,requestAnimationFrame(()=>{p(this,g,ue).call(this)&&(this.innerHTML="",l(this,y).forEach(n=>{const s=document.createElement("span");s.textContent=n.value,n.added?s.classList.add("diff-text-added"):n.removed&&(s.classList.add("diff-text-removed"),s.setAttribute("contenteditable",!1)),s.dataset.diffTextCount=n.count.toString(),this.appendChild(s)}))}))};let Q=$;customElements!=null&&customElements.define&&!customElements.get("diff-text")&&customElements.define("diff-text",Q);export{Q as DiffText};
//# sourceMappingURL=index-BdF9DUtU.js.map
