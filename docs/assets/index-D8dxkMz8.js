var C=r=>{throw TypeError(r)};var S=(r,a,t)=>a.has(r)||C("Cannot "+t);var e=(r,a,t)=>(S(r,a,"read from private field"),t?t.call(r):a.get(r)),R=(r,a,t)=>a.has(r)?C("Cannot add the same private member more than once"):a instanceof WeakSet?a.add(r):a.set(r,t),d=(r,a,t,s)=>(S(r,a,"write to private field"),s?s.call(r,t):a.set(r,t),t),n=(r,a,t)=>(S(r,a,"access private method"),t);var u,y,h,w,o,g,m,E,L,A,v;class q extends HTMLElement{constructor(){super(...arguments);R(this,o);R(this,u);R(this,y);R(this,h);R(this,w);R(this,m);d(this,u,null),d(this,y,[]),d(this,h,null),d(this,w,null),d(this,m,null),this.startCapture=async()=>{var s;if(this.stopCapture(),!this.isConnected)return;n(this,o,g).call(this,null);const t={video:{displaySurface:"window",autoGainControl:!1,suppressLocalAudioPlayback:!1},audio:this.hasAttribute("audio"),surfaceSwitching:"exclude",systemAudio:this.hasAttribute("audio")?"include":"exclude",preferCurrentTab:!0};try{d(this,u,await navigator.mediaDevices.getDisplayMedia(t));const c=this.shadowRoot.querySelector("#target");if(console.log("target Element",c,this.shadowRoot),!c)throw new Error('No target element found. capture-dom requires a target with ID "target".');const p=await RestrictionTarget.fromElement(this.shadowRoot.querySelector("#target"));if(!p)throw new Error('No restriction target found. capture-dom requires a target with ID "target".');switch(console.log(e(this,u),this.track),await((s=this.track)==null?void 0:s.restrictTo(p)),this.mode){case"element":{if(!this.element)throw new Error('Element mode requires an "element" attribute to be set.');if(document.querySelector(this.element)){const i=document.querySelector(this.element);if(i instanceof HTMLVideoElement||i instanceof HTMLAudioElement)i.srcObject=e(this,u),this.autoplay&&i.play(),this.audio&&(i.muted=!0);else throw new Error(`The element for selector "${this.element}" is not a video or audio element.`)}else throw new Error(`No element found for selector: ${this.element}`)}case"opfs":{e(this,m)||await n(this,o,L).call(this);break}case null:break;default:throw new Error(`Invalid mode: ${this.mode}.`)}e(this,h)&&(e(this,h).stop(),d(this,h,null)),d(this,y,[]),d(this,h,new MediaRecorder(e(this,u),{mimeType:"video/webm"})),e(this,h).addEventListener("dataavailable",(i=>{var f;if(e(this,y).push(i.data),this.mode==="opfs"&&e(this,m)&&e(this,m).write(i.data),this.download){const l=((f=this.shadowRoot)==null?void 0:f.querySelector("#download"))??null;l&&(l.href=URL.createObjectURL(i.data),l.download=e(this,o,E))}}).bind(this)),e(this,h).addEventListener("stop",(i=>{if(this.element){const f=this.blob?URL.createObjectURL(this.blob):"",l=document.querySelector(this.element);(l instanceof HTMLVideoElement||l instanceof HTMLAudioElement)&&(l.srcObject=null,l.src=f,n(this,o,v).call(this,"stopped"))}else n(this,o,v).call(this,"stopped")}).bind(this)),e(this,h).addEventListener("error",n(this,o,g).bind(this)),this.setAttribute("recording",""),e(this,h).start(),n(this,o,v).call(this,"started")}catch(c){n(this,o,g).call(this,c)}},this.stopCapture=async()=>{this.removeAttribute("recording"),e(this,u)&&(e(this,u).getTracks().forEach(t=>t.stop()),d(this,u,null)),e(this,h)&&(e(this,h).stop(),d(this,h,null)),e(this,m)&&d(this,m,null)}}static get observedAttributes(){return["element","file","mode","exportparts","audio","download","controlled","autoplay","background-color"]}get element(){return this.getAttribute("element")}set element(t){t!=null&&t.length?this.setAttribute("output-element",t):this.removeAttribute("output-element")}get file(){return this.getAttribute("file")}set file(t){t!=null&&t.length?this.setAttribute("file",t):this.removeAttribute("file")}get mode(){const t=this.getAttribute("mode");return t||(this.element?"element":null)}set mode(t){if(!t||t==="none")this.removeAttribute("mode");else{const s=["element","opfs","none"];s.includes(t)||n(this,o,g).call(this,new Error(`Invalid mode: ${t}. Valid modes are ${s.sort().join(", ")}.`))}}get download(){return this.hasAttribute("download")}set download(t){t?this.setAttribute("download",""):this.removeAttribute("download")}get controlled(){return this.hasAttribute("controlled")}set controlled(t){t?this.setAttribute("controlled",""):this.removeAttribute("controlled")}get error(){return e(this,w)}get blob(){return e(this,y).length?new Blob(e(this,y),{type:"video/webm"}):null}get captureUrl(){const t=this.blob;return t?URL.createObjectURL(t):null}get track(){var t;return((t=e(this,u))==null?void 0:t.getVideoTracks()[0])||null}get autoplay(){return this.hasAttribute("autoplay")}set autoplay(t){t?this.setAttribute("autoplay",""):this.removeAttribute("autoplay")}get backgroundColor(){return this.getAttribute("background-color")||"white"}set backgroundColor(t){t?this.setAttribute("background-color",t):this.removeAttribute("background-color")}get audio(){return this.hasAttribute("audio")}set audio(t){t?this.setAttribute("audio",""):this.removeAttribute("audio")}downloadCapture(){try{this.blob?n(this,o,v).call(this,"download"):n(this,o,g).call(this,new Error("No capture data available to download."))}catch(t){n(this,o,g).call(this,t)}}connectedCallback(){n(this,o,A).call(this)}disconnectedCallback(){this.stopCapture()}attributeChangedCallback(t,s,c){const p=["controls","start","stop","target","error"];t==="exportparts"&&c!==p.sort().join(",")?this.setAttribute("exportparts",p.sort().join(",")):(this.stopCapture(),n(this,o,A).call(this))}}u=new WeakMap,y=new WeakMap,h=new WeakMap,w=new WeakMap,o=new WeakSet,g=function(t){var s;if(t&&(this.stopCapture(),console.error(t),d(this,w,t),n(this,o,v).call(this,"error"),!this.controlled&&(!this.shadowRoot||!this.shadowRoot.querySelector("#error"))&&n(this,o,A).call(this)),!this.controlled){const c=(s=this.shadowRoot)==null?void 0:s.querySelector("#error");c&&(c.textContent=t?t.message?t.message:JSON.stringify(t):"")}},m=new WeakMap,E=function(){return this.file??`${this.id?`${this.id}-`:""}${new Date().toISOString().replaceAll(":","-")}.webm`},L=async function(){if(!e(this,m)||e(this,m).name!==e(this,o,E)){const s=await(await navigator.storage.getDirectory()).getFileHandle(e(this,o,E),{create:!0});d(this,m,s)}},A=function(){var t,s,c,p;try{if(this.shadowRoot||this.attachShadow({mode:"open"}),this.shadowRoot){const i=this.querySelector("template"),f=this.download?`<a id="download" download href="" file="${e(this,o,E)}"><slot name="download" part="download"></slot></a>`:"";if(i?(this.shadowRoot.innerHTML=i.content.cloneNode(!0).outerHTML,this.controlled||(this.shadowRoot.querySelector("#controls")||(this.shadowRoot.innerHTML='<div id="controls" part="controls"></div>'+this.shadowRoot.innerHTML),this.shadowRoot.querySelector("#target")||(this.shadowRoot.innerHTML+='<div id="target" part="target"><slot></slot></div>'),this.download&&!this.shadowRoot.querySelector("#download")&&(this.querySelector("#controls").innerHTML+=f))):this.controlled?this.shadowRoot.innerHTML='<div id="target" part="target"><slot></slot></div>':this.shadowRoot.innerHTML=`
                        <div id="controls" part="controls">
                            <button id="start"><slot name="start"></slot></button>
                            <button id="stop"><slot name="stop"></slot></button>
                            ${f}
                        </div>
                        <div id="error" part="error"></div>
                        <div id="target" part="target"><slot></slot></div>`,!this.controlled&&!this.shadowRoot.querySelector("#start")){const b=document.createElement("button");b.id="start",b.textContent="Start",this.shadowRoot.querySelector("#controls").appendChild(b)}if(!this.controlled&&!this.shadowRoot.querySelector("#stop")){const b=document.createElement("button");b.id="stop",b.textContent="Stop",this.shadowRoot.querySelector("#controls").appendChild(b)}if(!this.controlled&&this.download&&!this.shadowRoot.querySelector("#download")){const b=document.createElement("button");b.id="download",b.textContent="Download",this.shadowRoot.querySelector("#controls").appendChild(b)}this.controlled||((t=this.shadowRoot.querySelector("#start"))==null||t.addEventListener("click",this.startCapture.bind(this)),(s=this.shadowRoot.querySelector("#stop"))==null||s.addEventListener("click",this.stopCapture.bind(this)),this.download&&((c=this.shadowRoot.querySelector("#download"))==null||c.addEventListener("click",this.downloadCapture.bind(this))),e(this,w)&&this.shadowRoot.querySelector("#error")&&(this.shadowRoot.querySelector("#error").textContent=e(this,w).message?e(this,w).message:"An error occurred during capture."));const l=((p=this.shadowRoot)==null?void 0:p.querySelector("#target"))??null;l&&(l.style.isolation="isolate",l.style.transformStyle="flatten",l.style.backgroundColor=this.backgroundColor??"white")}}catch(i){n(this,o,g).call(this,i)}},v=function(t){const s=`capture-dom-${t}`,c={bubbles:!0,cancelable:!1,composed:!0},p={mode:this.mode,file:this.file,element:this.element},i=f=>{const l=new CustomEvent(s,{...c,detail:{...p,...f}});this.dispatchEvent(l)};switch(t){case"error":i({error:e(this,w)});break;case"stopped":case"download":i({blob:this.blob,url:this.blob?URL.createObjectURL(this.blob):""});break;case"started":default:i();break}};customElements&&!customElements.get("capture-dom")&&customElements.define("capture-dom",q);export{q as CaptureDOM};
//# sourceMappingURL=index-D8dxkMz8.js.map
