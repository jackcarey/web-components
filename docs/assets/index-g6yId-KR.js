var ee=i=>{throw TypeError(i)};var H=(i,t,e)=>t.has(i)||ee("Cannot "+e);var u=(i,t,e)=>(H(i,t,"read from private field"),e?e.call(i):t.get(i)),b=(i,t,e)=>t.has(i)?ee("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),g=(i,t,e,n)=>(H(i,t,"write to private field"),n?n.call(i,e):t.set(i,e),e),C=(i,t,e)=>(H(i,t,"access private method"),e);class D{diff(t,e,n={}){let s;typeof n=="function"?(s=n,n={}):"callback"in n&&(s=n.callback);const r=this.castInput(t,n),o=this.castInput(e,n),l=this.removeEmpty(this.tokenize(r,n)),c=this.removeEmpty(this.tokenize(o,n));return this.diffWithOptionsObj(l,c,n,s)}diffWithOptionsObj(t,e,n,s){var r;const o=d=>{if(d=this.postProcess(d,n),s){setTimeout(function(){s(d)},0);return}else return d},l=e.length,c=t.length;let f=1,h=l+c;n.maxEditLength!=null&&(h=Math.min(h,n.maxEditLength));const A=(r=n.timeout)!==null&&r!==void 0?r:1/0,a=Date.now()+A,p=[{oldPos:-1,lastComponent:void 0}];let O=this.extractCommon(p[0],e,t,0,n);if(p[0].oldPos+1>=c&&O+1>=l)return o(this.buildValues(p[0].lastComponent,e,t));let B=-1/0,R=1/0;const X=()=>{for(let d=Math.max(B,-f);d<=Math.min(R,f);d+=2){let L;const z=p[d-1],F=p[d+1];z&&(p[d-1]=void 0);let _=!1;if(F){const K=F.oldPos-d;_=F&&0<=K&&K<l}const Y=z&&z.oldPos+1<c;if(!_&&!Y){p[d]=void 0;continue}if(!Y||_&&z.oldPos<F.oldPos?L=this.addToPath(F,!0,!1,0,n):L=this.addToPath(z,!1,!0,1,n),O=this.extractCommon(L,e,t,d,n),L.oldPos+1>=c&&O+1>=l)return o(this.buildValues(L.lastComponent,e,t))||!0;p[d]=L,L.oldPos+1>=c&&(R=Math.min(R,d-1)),O+1>=l&&(B=Math.max(B,d+1))}f++};if(s)(function d(){setTimeout(function(){if(f>h||Date.now()>a)return s(void 0);X()||d()},0)})();else for(;f<=h&&Date.now()<=a;){const d=X();if(d)return d}}addToPath(t,e,n,s,r){const o=t.lastComponent;return o&&!r.oneChangePerToken&&o.added===e&&o.removed===n?{oldPos:t.oldPos+s,lastComponent:{count:o.count+1,added:e,removed:n,previousComponent:o.previousComponent}}:{oldPos:t.oldPos+s,lastComponent:{count:1,added:e,removed:n,previousComponent:o}}}extractCommon(t,e,n,s,r){const o=e.length,l=n.length;let c=t.oldPos,f=c-s,h=0;for(;f+1<o&&c+1<l&&this.equals(n[c+1],e[f+1],r);)f++,c++,h++,r.oneChangePerToken&&(t.lastComponent={count:1,previousComponent:t.lastComponent,added:!1,removed:!1});return h&&!r.oneChangePerToken&&(t.lastComponent={count:h,previousComponent:t.lastComponent,added:!1,removed:!1}),t.oldPos=c,f}equals(t,e,n){return n.comparator?n.comparator(t,e):t===e||!!n.ignoreCase&&t.toLowerCase()===e.toLowerCase()}removeEmpty(t){const e=[];for(let n=0;n<t.length;n++)t[n]&&e.push(t[n]);return e}castInput(t,e){return t}tokenize(t,e){return Array.from(t)}join(t){return t.join("")}postProcess(t,e){return t}get useLongestToken(){return!1}buildValues(t,e,n){const s=[];let r;for(;t;)s.push(t),r=t.previousComponent,delete t.previousComponent,t=r;s.reverse();const o=s.length;let l=0,c=0,f=0;for(;l<o;l++){const h=s[l];if(h.removed)h.value=this.join(n.slice(f,f+h.count)),f+=h.count;else{if(!h.added&&this.useLongestToken){let A=e.slice(c,c+h.count);A=A.map(function(a,p){const O=n[f+p];return O.length>a.length?O:a}),h.value=this.join(A)}else h.value=this.join(e.slice(c,c+h.count));c+=h.count,h.added||(f+=h.count)}}return s}}class he extends D{}const fe=new he;function ae(i,t,e){return fe.diff(i,t,e)}function te(i,t){let e;for(e=0;e<i.length&&e<t.length;e++)if(i[e]!=t[e])return i.slice(0,e);return i.slice(0,e)}function ne(i,t){let e;if(!i||!t||i[i.length-1]!=t[t.length-1])return"";for(e=0;e<i.length&&e<t.length;e++)if(i[i.length-(e+1)]!=t[t.length-(e+1)])return i.slice(-e);return i.slice(-e)}function V(i,t,e){if(i.slice(0,t.length)!=t)throw Error(`string ${JSON.stringify(i)} doesn't start with prefix ${JSON.stringify(t)}; this is a bug`);return e+i.slice(t.length)}function Z(i,t,e){if(!t)return i+e;if(i.slice(-t.length)!=t)throw Error(`string ${JSON.stringify(i)} doesn't end with suffix ${JSON.stringify(t)}; this is a bug`);return i.slice(0,-t.length)+e}function q(i,t){return V(i,t,"")}function j(i,t){return Z(i,t,"")}function ie(i,t){return t.slice(0,de(i,t))}function de(i,t){let e=0;i.length>t.length&&(e=i.length-t.length);let n=t.length;i.length<t.length&&(n=i.length);const s=Array(n);let r=0;s[0]=0;for(let o=1;o<n;o++){for(t[o]==t[r]?s[o]=s[r]:s[o]=r;r>0&&t[o]!=t[r];)r=s[r];t[o]==t[r]&&r++}r=0;for(let o=e;o<i.length;o++){for(;r>0&&i[o]!=t[r];)r=s[r];i[o]==t[r]&&r++}return r}function M(i){let t;for(t=i.length-1;t>=0&&i[t].match(/\s/);t--);return i.substring(t+1)}function W(i){const t=i.match(/^\s*/);return t?t[0]:""}const J="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",ge=new RegExp(`[${J}]+|\\s+|[^${J}]`,"ug");class me extends D{equals(t,e,n){return n.ignoreCase&&(t=t.toLowerCase(),e=e.toLowerCase()),t.trim()===e.trim()}tokenize(t,e={}){let n;if(e.intlSegmenter){const o=e.intlSegmenter;if(o.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');n=Array.from(o.segment(t),l=>l.segment)}else n=t.match(ge)||[];const s=[];let r=null;return n.forEach(o=>{/\s/.test(o)?r==null?s.push(o):s.push(s.pop()+o):r!=null&&/\s/.test(r)?s[s.length-1]==r?s.push(s.pop()+o):s.push(r+o):s.push(o),r=o}),s}join(t){return t.map((e,n)=>n==0?e:e.replace(/^\s+/,"")).join("")}postProcess(t,e){if(!t||e.oneChangePerToken)return t;let n=null,s=null,r=null;return t.forEach(o=>{o.added?s=o:o.removed?r=o:((s||r)&&se(n,r,s,o),n=o,s=null,r=null)}),(s||r)&&se(n,r,s,null),t}}const pe=new me;function oe(i,t,e){return(e==null?void 0:e.ignoreWhitespace)!=null&&!e.ignoreWhitespace?ce(i,t,e):pe.diff(i,t,e)}function se(i,t,e,n){if(t&&e){const s=W(t.value),r=M(t.value),o=W(e.value),l=M(e.value);if(i){const c=te(s,o);i.value=Z(i.value,o,c),t.value=q(t.value,c),e.value=q(e.value,c)}if(n){const c=ne(r,l);n.value=V(n.value,l,c),t.value=j(t.value,c),e.value=j(e.value,c)}}else if(e){if(i){const s=W(e.value);e.value=e.value.substring(s.length)}if(n){const s=W(n.value);n.value=n.value.substring(s.length)}}else if(i&&n){const s=W(n.value),r=W(t.value),o=M(t.value),l=te(s,r);t.value=q(t.value,l);const c=ne(q(s,l),o);t.value=j(t.value,c),n.value=V(n.value,s,c),i.value=Z(i.value,s,s.slice(0,s.length-c.length))}else if(n){const s=W(n.value),r=M(t.value),o=ie(r,s);t.value=j(t.value,o)}else if(i){const s=M(i.value),r=W(t.value),o=ie(s,r);t.value=q(t.value,o)}}class Ae extends D{tokenize(t){const e=new RegExp(`(\\r?\\n)|[${J}]+|[^\\S\\n\\r]+|[^${J}]`,"ug");return t.match(e)||[]}}const Ce=new Ae;function ce(i,t,e){return Ce.diff(i,t,e)}class ve extends D{constructor(){super(...arguments),this.tokenize=le}equals(t,e,n){return n.ignoreWhitespace?((!n.newlineIsToken||!t.includes(`
`))&&(t=t.trim()),(!n.newlineIsToken||!e.includes(`
`))&&(e=e.trim())):n.ignoreNewlineAtEof&&!n.newlineIsToken&&(t.endsWith(`
`)&&(t=t.slice(0,-1)),e.endsWith(`
`)&&(e=e.slice(0,-1))),super.equals(t,e,n)}}const be=new ve;function we(i,t,e){return be.diff(i,t,e)}function le(i,t){t.stripTrailingCr&&(i=i.replace(/\r\n/g,`
`));const e=[],n=i.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(let s=0;s<n.length;s++){const r=n[s];s%2&&!t.newlineIsToken?e[e.length-1]+=r:e.push(r)}return e}function xe(i){return i=="."||i=="!"||i=="?"}class Se extends D{tokenize(t){var e;const n=[];let s=0;for(let r=0;r<t.length;r++){if(r==t.length-1){n.push(t.slice(s));break}if(xe(t[r])&&t[r+1].match(/\s/)){for(n.push(t.slice(s,r+1)),r=s=r+1;!((e=t[r+1])===null||e===void 0)&&e.match(/\s/);)r++;n.push(t.slice(s,r+1)),s=r+1}}return n}}const Ee=new Se;function Pe(i,t,e){return Ee.diff(i,t,e)}class ye extends D{tokenize(t){return t.split(/([{}:;,]|\s+)/)}}const We=new ye;function De(i,t,e){return We.diff(i,t,e)}class Oe extends D{constructor(){super(...arguments),this.tokenize=le}get useLongestToken(){return!0}castInput(t,e){const{undefinedReplacement:n,stringifyReplacer:s=(r,o)=>typeof o>"u"?n:o}=e;return typeof t=="string"?t:JSON.stringify(G(t,null,null,s),null,"  ")}equals(t,e,n){return super.equals(t.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"),n)}}const Le=new Oe;function Ie(i,t,e){return Le.diff(i,t,e)}function G(i,t,e,n,s){t=t||[],e=e||[],n&&(i=n(s===void 0?"":s,i));let r;for(r=0;r<t.length;r+=1)if(t[r]===i)return e[r];let o;if(Object.prototype.toString.call(i)==="[object Array]"){for(t.push(i),o=new Array(i.length),e.push(o),r=0;r<i.length;r+=1)o[r]=G(i[r],t,e,n,String(r));return t.pop(),e.pop(),o}if(i&&i.toJSON&&(i=i.toJSON()),typeof i=="object"&&i!==null){t.push(i),o={},e.push(o);const l=[];let c;for(c in i)Object.prototype.hasOwnProperty.call(i,c)&&l.push(c);for(l.sort(),r=0;r<l.length;r+=1)c=l[r],o[c]=G(i[c],t,e,n,c);t.pop(),e.pop()}else o=i;return o}class Ne extends D{tokenize(t){return t.slice()}join(t){return t}removeEmpty(t){return t}}const Te=new Ne;function ze(i,t,e){return Te.diff(i,t,e)}const re={word:oe,chars:ae,wordsWithSpaces:ce,lines:we,sentences:Pe,css:De,json:Ie,arrays:ze};var x,S,v,E,P,y,N,T,m,U,I,k,ue,w;const $=class $ extends HTMLElement{constructor(){super();b(this,m);b(this,x,null);b(this,S,null);b(this,v,null);b(this,E);b(this,P);b(this,y,[]);b(this,N,null);b(this,T,null);b(this,I,e=>{const n=e.innerText,s=this.compare;if(!(s!=null&&s.length))return n;const r=s in e?e[s]:null;if(s)return r;const o=e.getAttribute(s);return o||r||o||n})}static get setupAttrs(){return["original-selector","changed-selector","original-src","changed-src","refetch"]}static get observedAttributes(){return[...["mode","ignore-case"],...$.setupAttrs,"original","changed","compare"]}get changes(){return u(this,y)}get mode(){return this.getAttribute("mode")||"word"}set mode(e){e!=null&&e.length?this.removeAttribute("mode"):this.setAttribute("mode",e)}get ignoreCase(){return this.getAttribute("ignore-case")==="true"}set ignoreCase(e){e?this.setAttribute("ignore-case",""):this.removeAttribute("ignore-case")}get original(){return this.getAttribute("original")||""}set original(e){e!=null&&e.length?this.setAttribute("original",e):this.removeAttribute("original")}get changed(){return this.getAttribute("changed")||""}set changed(e){e!=null&&e.length?this.setAttribute("changed",e):this.removeAttribute("changed")}get originalSelector(){return this.getAttribute("original-selector")||""}set originalSelector(e){e!=null&&e.length?this.setAttribute("original-selector",e):this.removeAttribute("original-selector")}get changedSelector(){return this.getAttribute("changed-selector")||""}set changedSelector(e){e!=null&&e.length?this.setAttribute("changed-selector",e):this.removeAttribute("changed-selector")}get originalSrc(){return this.getAttribute("original-src")||""}set originalSrc(e){e!=null&&e.length?this.setAttribute("original-src",e):this.removeAttribute("original-src")}get changedSrc(){return this.getAttribute("changed-src")||""}set changedSrc(e){e!=null&&e.length?this.setAttribute("changed-src",e):this.removeAttribute("changed-src")}get refetch(){const e=this.getAttribute("refetch");if(e){const n=parseInt(e,10);return isNaN(n)||n<=0?void 0:n}}set refetch(e){if(e!=null&&e.length)try{parseInt(e,10)?this.setAttribute("refetch",e):this.removeAttribute("refetch")}catch{this.removeAttribute("refetch")}else this.removeAttribute("refetch")}get compare(){return this.getAttribute("compare")}set compare(e){e!=null&&e.length?this.setAttribute("compare",e):this.removeAttribute("compare")}connectedCallback(){C(this,m,k).call(this),C(this,m,w).call(this)}disconnectedCallback(){var e,n;(e=u(this,x))==null||e.disconnect(),g(this,x,null),(n=u(this,S))==null||n.disconnect(),g(this,S,null),u(this,v)&&(clearInterval(u(this,v)),g(this,v,null))}get options(){return u(this,T)||void 0}set options(e){e?g(this,T,e):g(this,T,null),C(this,m,w).call(this)}attributeChangedCallback(e,n,s){if(e==="mode"&&(s!=null&&s.length)&&!re[s]){this.setAttribute("mode","word");return}e==="original"&&g(this,E,s),e==="changed"&&g(this,P,s),$.setupAttrs.includes(e)&&C(this,m,k).call(this),C(this,m,w).call(this)}refresh(){C(this,m,k).call(this),C(this,m,w).call(this)}};x=new WeakMap,S=new WeakMap,v=new WeakMap,E=new WeakMap,P=new WeakMap,y=new WeakMap,N=new WeakMap,T=new WeakMap,m=new WeakSet,U=function(){const e=this.getAttribute("original-src"),n=this.getAttribute("changed-src"),s=[],r=[];e&&s.push(fetch(e).then(o=>this.mode==="json"?o.json():o.text()).then(o=>{g(this,E,o)}).catch(o=>r.push(o))),n&&s.push(fetch(n).then(o=>this.mode==="json"?o.json():o.text()).then(o=>{g(this,P,o)}).catch(o=>r.push(o))),Promise.allSettled(s).then(()=>{r.length&&(console.error("Error fetching diff text sources:"),r.forEach(o=>console.error(o))),C(this,m,w).call(this)})},I=new WeakMap,k=function(){var h,A;this.disconnectedCallback();const e=!!this.getAttribute("original-src"),n=!!this.getAttribute("changed-src"),s=this.getAttribute("refetch"),r=s?parseInt(s,10):0,o=(e||n)&&!!r,l=!e&&!!this.originalSelector,c=!n&&!!this.changedSelector;(e||n)&&C(this,m,U).call(this),o&&(u(this,v)&&clearInterval(u(this,v)),u(this,v)&&(clearInterval(u(this,v)),g(this,v,null)),g(this,v,setInterval(()=>{C(this,m,U).call(this),C(this,m,w).call(this)},Math.max(1e3,r*1e3))));const f={childList:!0,subtree:!0,attributes:!0,characterData:!0};if(l&&(u(this,x)?u(this,x).disconnect():this.originalSelector&&g(this,x,new MutationObserver(()=>{const a=document.querySelector(this.originalSelector);g(this,E,u(this,I).call(this,a)),C(this,m,w).call(this)})),this.originalSelector)){const a=document.querySelector(this.originalSelector);a&&((h=u(this,x))==null||h.observe(a,f),g(this,E,u(this,I).call(this,a)))}if(c&&(u(this,S)?u(this,S).disconnect():this.changedSelector&&g(this,S,new MutationObserver(()=>{const a=document.querySelector(this.changedSelector);g(this,P,u(this,I).call(this,a)),C(this,m,w).call(this)})),this.changedSelector)){const a=document.querySelector(this.changedSelector);a&&((A=u(this,S))==null||A.observe(a,f),g(this,P,u(this,I).call(this,a)))}},ue=function(){var c,f,h;const e=re[this.mode]||oe,n=u(this,E),s=u(this,P),r=structuredClone(u(this,y)),o=e(n??"",s??"",{ignoreCase:!!this.ignoreCase,...this.options??{},callback:void 0}),l=o.length!==r.length||o.some((A,a)=>{const p=r[a];return!p||A.value!==p.value||A.added!==p.added||A.removed!==p.removed||A.count!==p.count});if(l){g(this,y,o),this.options&&((c=this.options)!=null&&c.callback)&&typeof((f=this.options)==null?void 0:f.callback)=="function"&&((h=this.options)==null||h.callback(u(this,y)));const A={...Object.fromEntries($.observedAttributes.map(a=>[a,this.getAttribute(a)])),options:this.options,original:u(this,E),changed:u(this,P),changes:u(this,y)};this.dispatchEvent(new CustomEvent("diff-text",{detail:A,bubbles:!0,composed:!0,cancelable:!0}))}return l},w=function(){u(this,N)&&cancelAnimationFrame(u(this,N)),g(this,N,requestAnimationFrame(()=>{C(this,m,ue).call(this)&&(this.innerHTML="",u(this,y).forEach(n=>{const s=document.createElement("span");s.textContent=n.value,n.added?s.classList.add("diff-text-added"):n.removed&&s.classList.add("diff-text-removed"),s.dataset.diffTextCount=n.count.toString(),this.appendChild(s)}))}))};let Q=$;customElements&&(customElements!=null&&customElements.define)&&customElements.define("diff-text",Q);export{Q as DiffText};
//# sourceMappingURL=index-g6yId-KR.js.map
