var te=i=>{throw TypeError(i)};var _=(i,t,e)=>t.has(i)||te("Cannot "+e);var c=(i,t,e)=>(_(i,t,"read from private field"),e?e.call(i):t.get(i)),C=(i,t,e)=>t.has(i)?te("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),d=(i,t,e,n)=>(_(i,t,"write to private field"),n?n.call(i,e):t.set(i,e),e),p=(i,t,e)=>(_(i,t,"access private method"),e);class L{diff(t,e,n={}){let r;typeof n=="function"?(r=n,n={}):"callback"in n&&(r=n.callback);const s=this.castInput(t,n),o=this.castInput(e,n),u=this.removeEmpty(this.tokenize(s,n)),l=this.removeEmpty(this.tokenize(o,n));return this.diffWithOptionsObj(u,l,n,r)}diffWithOptionsObj(t,e,n,r){var s;const o=m=>{if(m=this.postProcess(m,n),r){setTimeout(function(){r(m)},0);return}else return m},u=e.length,l=t.length;let h=1,f=u+l;n.maxEditLength!=null&&(f=Math.min(f,n.maxEditLength));const A=(s=n.timeout)!==null&&s!==void 0?s:1/0,g=Date.now()+A,S=[{oldPos:-1,lastComponent:void 0}];let O=this.extractCommon(S[0],e,t,0,n);if(S[0].oldPos+1>=l&&O+1>=u)return o(this.buildValues(S[0].lastComponent,e,t));let R=-1/0,H=1/0;const Y=()=>{for(let m=Math.max(R,-h);m<=Math.min(H,h);m+=2){let I;const F=S[m-1],q=S[m+1];F&&(S[m-1]=void 0);let V=!1;if(q){const ee=q.oldPos-m;V=q&&0<=ee&&ee<u}const K=F&&F.oldPos+1<l;if(!V&&!K){S[m]=void 0;continue}if(!K||V&&F.oldPos<q.oldPos?I=this.addToPath(q,!0,!1,0,n):I=this.addToPath(F,!1,!0,1,n),O=this.extractCommon(I,e,t,m,n),I.oldPos+1>=l&&O+1>=u)return o(this.buildValues(I.lastComponent,e,t))||!0;S[m]=I,I.oldPos+1>=l&&(H=Math.min(H,m-1)),O+1>=u&&(R=Math.max(R,m+1))}h++};if(r)(function m(){setTimeout(function(){if(h>f||Date.now()>g)return r(void 0);Y()||m()},0)})();else for(;h<=f&&Date.now()<=g;){const m=Y();if(m)return m}}addToPath(t,e,n,r,s){const o=t.lastComponent;return o&&!s.oneChangePerToken&&o.added===e&&o.removed===n?{oldPos:t.oldPos+r,lastComponent:{count:o.count+1,added:e,removed:n,previousComponent:o.previousComponent}}:{oldPos:t.oldPos+r,lastComponent:{count:1,added:e,removed:n,previousComponent:o}}}extractCommon(t,e,n,r,s){const o=e.length,u=n.length;let l=t.oldPos,h=l-r,f=0;for(;h+1<o&&l+1<u&&this.equals(n[l+1],e[h+1],s);)h++,l++,f++,s.oneChangePerToken&&(t.lastComponent={count:1,previousComponent:t.lastComponent,added:!1,removed:!1});return f&&!s.oneChangePerToken&&(t.lastComponent={count:f,previousComponent:t.lastComponent,added:!1,removed:!1}),t.oldPos=l,h}equals(t,e,n){return n.comparator?n.comparator(t,e):t===e||!!n.ignoreCase&&t.toLowerCase()===e.toLowerCase()}removeEmpty(t){const e=[];for(let n=0;n<t.length;n++)t[n]&&e.push(t[n]);return e}castInput(t,e){return t}tokenize(t,e){return Array.from(t)}join(t){return t.join("")}postProcess(t,e){return t}get useLongestToken(){return!1}buildValues(t,e,n){const r=[];let s;for(;t;)r.push(t),s=t.previousComponent,delete t.previousComponent,t=s;r.reverse();const o=r.length;let u=0,l=0,h=0;for(;u<o;u++){const f=r[u];if(f.removed)f.value=this.join(n.slice(h,h+f.count)),h+=f.count;else{if(!f.added&&this.useLongestToken){let A=e.slice(l,l+f.count);A=A.map(function(g,S){const O=n[h+S];return O.length>g.length?O:g}),f.value=this.join(A)}else f.value=this.join(e.slice(l,l+f.count));l+=f.count,f.added||(h+=f.count)}}return r}}class fe extends L{}const ae=new fe;function de(i,t,e){return ae.diff(i,t,e)}function ne(i,t){let e;for(e=0;e<i.length&&e<t.length;e++)if(i[e]!=t[e])return i.slice(0,e);return i.slice(0,e)}function ie(i,t){let e;if(!i||!t||i[i.length-1]!=t[t.length-1])return"";for(e=0;e<i.length&&e<t.length;e++)if(i[i.length-(e+1)]!=t[t.length-(e+1)])return i.slice(-e);return i.slice(-e)}function Z(i,t,e){if(i.slice(0,t.length)!=t)throw Error(`string ${JSON.stringify(i)} doesn't start with prefix ${JSON.stringify(t)}; this is a bug`);return e+i.slice(t.length)}function G(i,t,e){if(!t)return i+e;if(i.slice(-t.length)!=t)throw Error(`string ${JSON.stringify(i)} doesn't end with suffix ${JSON.stringify(t)}; this is a bug`);return i.slice(0,-t.length)+e}function M(i,t){return Z(i,t,"")}function $(i,t){return G(i,t,"")}function se(i,t){return t.slice(0,ge(i,t))}function ge(i,t){let e=0;i.length>t.length&&(e=i.length-t.length);let n=t.length;i.length<t.length&&(n=i.length);const r=Array(n);let s=0;r[0]=0;for(let o=1;o<n;o++){for(t[o]==t[s]?r[o]=r[s]:r[o]=s;s>0&&t[o]!=t[s];)s=r[s];t[o]==t[s]&&s++}s=0;for(let o=e;o<i.length;o++){for(;s>0&&i[o]!=t[s];)s=r[s];i[o]==t[s]&&s++}return s}function j(i){let t;for(t=i.length-1;t>=0&&i[t].match(/\s/);t--);return i.substring(t+1)}function D(i){const t=i.match(/^\s*/);return t?t[0]:""}const B="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",me=new RegExp(`[${B}]+|\\s+|[^${B}]`,"ug");class pe extends L{equals(t,e,n){return n.ignoreCase&&(t=t.toLowerCase(),e=e.toLowerCase()),t.trim()===e.trim()}tokenize(t,e={}){let n;if(e.intlSegmenter){const o=e.intlSegmenter;if(o.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');n=Array.from(o.segment(t),u=>u.segment)}else n=t.match(me)||[];const r=[];let s=null;return n.forEach(o=>{/\s/.test(o)?s==null?r.push(o):r.push(r.pop()+o):s!=null&&/\s/.test(s)?r[r.length-1]==s?r.push(r.pop()+o):r.push(s+o):r.push(o),s=o}),r}join(t){return t.map((e,n)=>n==0?e:e.replace(/^\s+/,"")).join("")}postProcess(t,e){if(!t||e.oneChangePerToken)return t;let n=null,r=null,s=null;return t.forEach(o=>{o.added?r=o:o.removed?s=o:((r||s)&&re(n,s,r,o),n=o,r=null,s=null)}),(r||s)&&re(n,s,r,null),t}}const Ae=new pe;function le(i,t,e){return(e==null?void 0:e.ignoreWhitespace)!=null&&!e.ignoreWhitespace?ce(i,t,e):Ae.diff(i,t,e)}function re(i,t,e,n){if(t&&e){const r=D(t.value),s=j(t.value),o=D(e.value),u=j(e.value);if(i){const l=ne(r,o);i.value=G(i.value,o,l),t.value=M(t.value,l),e.value=M(e.value,l)}if(n){const l=ie(s,u);n.value=Z(n.value,u,l),t.value=$(t.value,l),e.value=$(e.value,l)}}else if(e){if(i){const r=D(e.value);e.value=e.value.substring(r.length)}if(n){const r=D(n.value);n.value=n.value.substring(r.length)}}else if(i&&n){const r=D(n.value),s=D(t.value),o=j(t.value),u=ne(r,s);t.value=M(t.value,u);const l=ie(M(r,u),o);t.value=$(t.value,l),n.value=Z(n.value,r,l),i.value=G(i.value,r,r.slice(0,r.length-l.length))}else if(n){const r=D(n.value),s=j(t.value),o=se(s,r);t.value=$(t.value,o)}else if(i){const r=j(i.value),s=D(t.value),o=se(r,s);t.value=M(t.value,o)}}class be extends L{tokenize(t){const e=new RegExp(`(\\r?\\n)|[${B}]+|[^\\S\\n\\r]+|[^${B}]`,"ug");return t.match(e)||[]}}const Ce=new be;function ce(i,t,e){return Ce.diff(i,t,e)}class ve extends L{constructor(){super(...arguments),this.tokenize=ue}equals(t,e,n){return n.ignoreWhitespace?((!n.newlineIsToken||!t.includes(`
`))&&(t=t.trim()),(!n.newlineIsToken||!e.includes(`
`))&&(e=e.trim())):n.ignoreNewlineAtEof&&!n.newlineIsToken&&(t.endsWith(`
`)&&(t=t.slice(0,-1)),e.endsWith(`
`)&&(e=e.slice(0,-1))),super.equals(t,e,n)}}const xe=new ve;function we(i,t,e){return xe.diff(i,t,e)}function ue(i,t){t.stripTrailingCr&&(i=i.replace(/\r\n/g,`
`));const e=[],n=i.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(let r=0;r<n.length;r++){const s=n[r];r%2&&!t.newlineIsToken?e[e.length-1]+=s:e.push(s)}return e}function Se(i){return i=="."||i=="!"||i=="?"}class Ee extends L{tokenize(t){var e;const n=[];let r=0;for(let s=0;s<t.length;s++){if(s==t.length-1){n.push(t.slice(r));break}if(Se(t[s])&&t[s+1].match(/\s/)){for(n.push(t.slice(r,s+1)),s=r=s+1;!((e=t[s+1])===null||e===void 0)&&e.match(/\s/);)s++;n.push(t.slice(r,s+1)),r=s+1}}return n}}const Pe=new Ee;function ye(i,t,e){return Pe.diff(i,t,e)}class We extends L{tokenize(t){return t.split(/([{}:;,]|\s+)/)}}const De=new We;function Le(i,t,e){return De.diff(i,t,e)}class Oe extends L{constructor(){super(...arguments),this.tokenize=ue}get useLongestToken(){return!0}castInput(t,e){const{undefinedReplacement:n,stringifyReplacer:r=(s,o)=>typeof o>"u"?n:o}=e;return typeof t=="string"?t:JSON.stringify(Q(t,null,null,r),null,"  ")}equals(t,e,n){return super.equals(t.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"),n)}}const Ie=new Oe;function Te(i,t,e){return Ie.diff(i,t,e)}function Q(i,t,e,n,r){t=t||[],e=e||[],n&&(i=n(r===void 0?"":r,i));let s;for(s=0;s<t.length;s+=1)if(t[s]===i)return e[s];let o;if(Object.prototype.toString.call(i)==="[object Array]"){for(t.push(i),o=new Array(i.length),e.push(o),s=0;s<i.length;s+=1)o[s]=Q(i[s],t,e,n,String(s));return t.pop(),e.pop(),o}if(i&&i.toJSON&&(i=i.toJSON()),typeof i=="object"&&i!==null){t.push(i),o={},e.push(o);const u=[];let l;for(l in i)Object.prototype.hasOwnProperty.call(i,l)&&u.push(l);for(u.sort(),s=0;s<u.length;s+=1)l=u[s],o[l]=Q(i[l],t,e,n,l);t.pop(),e.pop()}else o=i;return o}class Ne extends L{tokenize(t){return t.slice()}join(t){return t}removeEmpty(t){return t}}const ze=new Ne;function Fe(i,t,e){return ze.diff(i,t,e)}const oe={word:le,chars:de,wordsWithSpaces:ce,lines:we,sentences:ye,css:Le,json:Te,arrays:Fe};var P,y,b,x,w,E,N,z,a,k,X,W,J,he,v;const T=class T extends HTMLElement{constructor(){super(...arguments);C(this,a);C(this,P,null);C(this,y,null);C(this,b,null);C(this,x);C(this,w);C(this,E,[]);C(this,N,null);C(this,z,null);C(this,W,e=>{const n=this.compare;if(!(n!=null&&n.length))return e.innerText;const r=n in e?e[n]:null;if(n)return r;const s=e.getAttribute(n);if(s)return s;if(e instanceof T){const u=this.mode==="lines"?`
`:"";return Array.from(e.children).filter(h=>!h.classList.contains("diff-text-removed")).map(h=>h.innerText).join(u)}return e.innerText})}static get setupAttrs(){return["original-selector","changed-selector","original-src","changed-src","refetch"]}static get observedAttributes(){return[...["mode","ignore-case"],...T.setupAttrs,"original","changed","compare"]}get changes(){return c(this,E)}get mode(){return this.getAttribute("mode")||"word"}set mode(e){e!=null&&e.length?this.removeAttribute("mode"):this.setAttribute("mode",e)}get ignoreCase(){return this.getAttribute("ignore-case")==="true"}set ignoreCase(e){e?this.setAttribute("ignore-case",""):this.removeAttribute("ignore-case")}get original(){return this.getAttribute("original")||""}set original(e){e!=null&&e.length?this.setAttribute("original",e):this.removeAttribute("original")}get changed(){return this.getAttribute("changed")||""}set changed(e){e!=null&&e.length?this.setAttribute("changed",e):this.removeAttribute("changed")}get originalSelector(){return this.getAttribute("original-selector")||""}set originalSelector(e){e!=null&&e.length?this.setAttribute("original-selector",e):this.removeAttribute("original-selector")}get changedSelector(){return this.getAttribute("changed-selector")||""}set changedSelector(e){e!=null&&e.length?this.setAttribute("changed-selector",e):this.removeAttribute("changed-selector")}get originalSrc(){return this.getAttribute("original-src")||""}set originalSrc(e){e!=null&&e.length?this.setAttribute("original-src",e):this.removeAttribute("original-src")}get changedSrc(){return this.getAttribute("changed-src")||""}set changedSrc(e){e!=null&&e.length?this.setAttribute("changed-src",e):this.removeAttribute("changed-src")}get refetch(){const e=this.getAttribute("refetch");if(e){const n=parseInt(e,10);return isNaN(n)||n<=0?void 0:n}}set refetch(e){if(e!=null&&e.length)try{parseInt(e,10)?this.setAttribute("refetch",e):this.removeAttribute("refetch")}catch{this.removeAttribute("refetch")}else this.removeAttribute("refetch")}get compare(){return this.getAttribute("compare")}set compare(e){e!=null&&e.length?this.setAttribute("compare",e):this.removeAttribute("compare")}get debug(){return this.hasAttribute("debug")}set debug(e){e?this.setAttribute("debug",""):this.removeAttribute("debug")}connectedCallback(){p(this,a,J).call(this),p(this,a,v).call(this)}disconnectedCallback(){var e,n;(e=c(this,P))==null||e.disconnect(),d(this,P,null),(n=c(this,y))==null||n.disconnect(),d(this,y,null),c(this,b)&&(clearInterval(c(this,b)),d(this,b,null))}get options(){return c(this,z)||void 0}set options(e){e?d(this,z,e):d(this,z,null),p(this,a,v).call(this)}attributeChangedCallback(e,n,r){if(e==="mode"&&(r!=null&&r.length)&&!oe[r]){this.setAttribute("mode","word");return}e==="original"&&d(this,x,r),e==="changed"&&d(this,w,r),T.setupAttrs.includes(e)&&p(this,a,J).call(this),p(this,a,v).call(this)}refresh(){p(this,a,J).call(this),p(this,a,v).call(this)}};P=new WeakMap,y=new WeakMap,b=new WeakMap,x=new WeakMap,w=new WeakMap,E=new WeakMap,N=new WeakMap,z=new WeakMap,a=new WeakSet,k=function(...e){this.debug&&console.log(...e)},X=function(){const e=this.getAttribute("original-src"),n=this.getAttribute("changed-src"),r=[],s=[];e&&r.push(fetch(e).then(o=>this.mode==="json"?o.json():o.text()).then(o=>{d(this,x,o)}).catch(o=>s.push(o))),n&&r.push(fetch(n).then(o=>this.mode==="json"?o.json():o.text()).then(o=>{d(this,w,o)}).catch(o=>s.push(o))),Promise.allSettled(r).then(()=>{s.length&&(console.error("Error fetching diff text sources:"),s.forEach(o=>console.error(o))),p(this,a,v).call(this)})},W=new WeakMap,J=function(){var f,A;this.disconnectedCallback();const e=!!this.getAttribute("original-src"),n=!!this.getAttribute("changed-src"),r=this.getAttribute("refetch"),s=r?parseInt(r,10):0,o=(e||n)&&!!s,u=!e&&!!this.originalSelector,l=!n&&!!this.changedSelector;(e||n)&&p(this,a,X).call(this),o&&(c(this,b)&&clearInterval(c(this,b)),c(this,b)&&(clearInterval(c(this,b)),d(this,b,null)),d(this,b,setInterval(()=>{p(this,a,X).call(this),p(this,a,v).call(this)},Math.max(1e3,s*1e3))));const h={childList:!0,subtree:!0,attributes:!0,characterData:!0};if(u&&(c(this,P)?c(this,P).disconnect():this.originalSelector&&d(this,P,new MutationObserver(()=>{const g=document.querySelector(this.originalSelector);d(this,x,c(this,W).call(this,g)),p(this,a,v).call(this)})),this.originalSelector)){const g=document.querySelector(this.originalSelector);g&&((f=c(this,P))==null||f.observe(g,h),g.addEventListener("input",()=>{d(this,x,c(this,W).call(this,g)),p(this,a,v).call(this)}),d(this,x,c(this,W).call(this,g)))}if(l&&(c(this,y)?c(this,y).disconnect():this.changedSelector&&d(this,y,new MutationObserver(()=>{console.log("changed mutation observer");const g=document.querySelector(this.changedSelector);d(this,w,c(this,W).call(this,g)),p(this,a,v).call(this)})),this.changedSelector)){const g=document.querySelector(this.changedSelector);g&&((A=c(this,y))==null||A.observe(g,h),g.addEventListener("input",()=>{d(this,w,c(this,W).call(this,g)),p(this,a,v).call(this)}),d(this,w,c(this,W).call(this,g)))}},he=function(){var o,u,l;const e=oe[this.mode]||le,n=structuredClone(c(this,E)),r=e(c(this,x)??"",c(this,w)??"",{ignoreCase:!!this.ignoreCase,...this.options??{},callback:void 0}),s=r.length!==n.length||r.some((h,f)=>{const A=n[f];return!A||h.value!==A.value||h.added!==A.added||h.removed!==A.removed||h.count!==A.count});if(p(this,a,k).call(this,{mode:this.mode,original:c(this,x),changed:c(this,w),newChanges:r,hasChanged:s}),s){d(this,E,r),this.options&&((o=this.options)!=null&&o.callback)&&typeof((u=this.options)==null?void 0:u.callback)=="function"&&((l=this.options)==null||l.callback(c(this,E)));const h={...Object.fromEntries(T.observedAttributes.map(f=>[f,this.getAttribute(f)])),options:this.options,original:c(this,x),changed:c(this,w),changes:c(this,E)};this.dispatchEvent(new CustomEvent("diff-text",{detail:h,bubbles:!0,composed:!0,cancelable:!0})),p(this,a,k).call(this,"diff-text emitted event")}return s},v=function(){c(this,N)&&cancelAnimationFrame(c(this,N)),d(this,N,requestAnimationFrame(()=>{p(this,a,he).call(this)&&(this.innerHTML="",p(this,a,k).call(this,"rendering changes",c(this,E)),c(this,E).forEach(n=>{const r=n.added?"ins":n.removed?"del":"span",s=document.createElement(r);s.textContent=n.value,n.removed&&s.setAttribute("contenteditable","false"),s.dataset.diffTextCount=n.count.toString(),this.appendChild(s)}))}))};let U=T;customElements!=null&&customElements.define&&!customElements.get("diff-text")&&customElements.define("diff-text",U);export{U as DiffText};
//# sourceMappingURL=index-BKuFXKMN.js.map
