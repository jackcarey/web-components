{"version":3,"file":"mutative-CakZl2_T.js","sources":["../../storybook-docs/utilities/mutative.mdx"],"sourcesContent":["# mutative\r\n\r\n[![mutative utility on Storybook](https://cdn.jsdelivr.net/gh/storybookjs/brand@main/badge/badge-storybook.svg)](https://jackcarey.co.uk/web-components/docs/?path=/docs/utilities-mutative) [![mutative version on JSR](https://jsr.io/badges/@web-components/mutative)](https://jsr.io/@web-components/mutative/versions) [![JSR score](https://jsr.io/badges/@web-components/mutative/score)](https://jsr.io/@web-components/mutative/score)\r\n\r\n> Persistent DOM mutation observations based on CSS query selectors\r\n\r\n-   **Version:** 1.0.3\r\n-   **License:** [LGPL-3](./LICENSE.md)\r\n\r\n## Using this package\r\n\r\n### Browser\r\n\r\n-   via the ESM CDN: [https://esm.sh/jsr/@web-components/mutative](https://esm.sh/jsr/@web-components/mutative)\r\n\r\n```html\r\n<script src=\"https://esm.sh/jsr/@web-components/mutative\" type=\"module\"></script>\r\n```\r\n\r\n### Deno\r\n\r\n```\r\ndeno add jsr:@web-components/mutative\r\n```\r\n\r\n### NPM\r\n\r\n-   JSR provides [NPM compatibility](https://jsr.io/docs/npm-compatibility). You can install this package with:\r\n\r\n```\r\nnpx jsr add @web-components/mutative\r\n```\r\n\r\n## Documentation\r\n\r\n-   **Open examples for [mutative on Storybook](https://jackcarey.co.uk/web-components/docs/?path=/docs/utilities-mutative)**.\r\n\r\nPersistent DOM mutation observations based on CSS query [selectors](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Selectors). It's essentially a wrapper for a global [MutationObserver](https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver) that filters records to specific callbacks. The API is _similar_ to MutationObserver, but not the same.\n\nThe advantage is that observers can be set up independently/ahead of matching DOM elements, which is useful when working with SPAs or other reactive content.\n\n```javascript\n// pass a single selector and callback\nMutative.observe(\"p\", (record) => console.log(record));\n\n//pass multiple selectors with the same callback\nMutative.observe([\"p\", \".text\", \"*[data-text]\"], (record) => console.log(\"text mutated\", record));\n\n//pass multiple selectors at once with different callbacks\nMutative.observe({\n    \"*[data-text]\": (rec) => console.log(rec),\n    p: (rec) => alert(\"paragraph edited\"),\n    output: (rec) => console.log(\"calculation updated\", rec),\n});\n\n//Remove observations for the 'p' selector only\nMutative.disconnect(\"p\");\n\n// Pause all observations\nMutative.disconnect();\n\n//Resume existing observations\nMutative.observe();\n```\n\n### observe()\n\nThe parameters are different from the MutationObserver implementation. Instead of a `target` and `options` there is `selectors` and `callback`.\n\n-   `selectors` - Several types are allowed:\n    -   `null` - If no arguments are passed, observation of existing selectors will resume.\n    -   `string` - a single CSS query selector.\n    -   `string[]` - multiple CSS query selectors that use the same `callback`.\n    -   `object` - CSS query selectors strings as keys, callbacks as values.\n-   `callback` - Only required when `selectors` is a string or array of strings. A function that accepts a MutationRecord as it's only parameter.\n\n### disconnect()\n\nMutations that have been detected but not yet reported to observers are _not_ discarded. Observer callbacks are triggered before disconnection. This method will either pause or remove observations and callbacks.\n\n-   **When called with no arguments:** acts the same as [disconnect()](https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver/disconnect), ignoring **all** _future_ mutations. Note: this does not clear the internal selector list, so calling `observe()` again will continue with existing selectors.\n-   **When passed with an argument:** The arguments follow the same formats as `observe()`'s `selectors` parameter. Only observers with the passed selectors are removed. If no selectors remain, observation is paused (as if no arguments were passed).\n\n### takeRecords()\n\nTakes all records from the Mutative object, use carefully. See: [takeRecords()](https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver/takeRecords).\n\n## How it works\n\nA single MutationObserver is created on the document `body` with the first call of `mutative.observe()`. MutationRecords are only passed to callbacks that have a matching selector for at least one of `target`, `addedNodes`, or `removedNodes`.\n\r\n\r\n---\r\n\r\nMade by [jackcarey](https://jackcarey.co.uk).\r\n"],"names":["_createMdxContent","props","_components","_provideComponents","_jsxs","_Fragment","_jsx","MDXContent","MDXLayout"],"mappings":"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"}