{"version":3,"file":"index-DPdnMMhe.js","sources":["../../packages/cite-list/index.ts"],"sourcesContent":["/**\n * Cite List Web Component\n * This component observes elements in the DOM and collects <cite> elements based on a selector.\n * It can limit the number of <cite> elements displayed and optionally link them to their original elements.\n * The component uses a MutationObserver to update the list dynamically when the DOM changes.\n * It renders the collected <cite> elements in an ordered list format.\n * @element cite-list\n * @attribute {string} selector - The CSS selector to observe for <cite> elements.\n * @attribute {number} limit - The maximum number of <cite> elements to display.\n * @attribute {boolean} link - If true, clicking on a list item scrolls to the corresponding <cite> element.\n * @example\n * <cite-list selector=\"article p\" limit=\"5\" link></cite-list>\n * This will create a list of up to 5 <cite> elements found within <article> paragraphs.\n */\nclass CiteList extends HTMLElement {\n    #mutationObserver: MutationObserver | null = null;\n    static get observedAttributes(): string[] {\n        return ['selector', 'limit', 'link', 'text-only', 'offset'];\n    }\n\n    get selector(): string | null {\n        return this.getAttribute('selector');\n    }\n\n    set selector(selector: string) {\n        if (selector?.length) {\n            this.setAttribute('selector', selector);\n        } else {\n            this.removeAttribute('selector');\n        }\n    }\n\n    get limit(): number {\n        try {\n            const limit = parseInt(this.getAttribute(\"limit\") || '0', 10);\n            if (isNaN(limit) || limit <= 0) {\n                return 0;\n            }\n            return limit;\n        } catch (e) {\n            return 0;\n        }\n    }\n\n    set limit(limit: number) {\n        if (limit >= 0) {\n            this.setAttribute('limit', limit.toString());\n        } else {\n            this.removeAttribute('limit');\n        }\n    }\n\n    get link(): boolean {\n        return this.getAttribute('link') === \"true\";\n    }\n\n    set link(value: boolean) {\n        if (value) {\n            this.setAttribute('link', 'true');\n        } else {\n            this.removeAttribute('link');\n        }\n    }\n\n    get textOnly(): boolean {\n        return this.hasAttribute('text-only');\n    }\n\n    set textOnly(value: boolean) {\n        if (value) {\n            this.setAttribute('text-only', '');\n        } else {\n            this.removeAttribute('text-only');\n        }\n    }\n\n    get offset(): number {\n        try {\n            const offset = parseInt(this.getAttribute(\"offset\") || '0', 0);\n            if (isNaN(offset)) {\n                return 0;\n            }\n            return offset;\n        } catch (e) {\n            return 0;\n        }\n    }\n\n    set offset(value: number) {\n        this.setAttribute('offset', String(value));\n    }\n\n    get observedElements(): Array<Element> {\n        if (!this.selector) return [];\n        const parents = document.querySelectorAll(this.selector);\n        return Array.from(parents);\n    }\n\n    get citationElements(): Array<Element> {\n        const parents = this.observedElements;\n        if (parents.length === 0) return [];\n        const cites: Element[] = [];\n        parents.forEach(parent => {\n            parent.querySelectorAll('cite').forEach(citeEl => {\n                if (!cites.includes(citeEl)) {\n                    cites.push(citeEl);\n                }\n            });\n        });\n        return cites.slice(this.offset, this.limit ? this.offset + this.limit : undefined);\n    }\n\n    #setupObserver(): void {\n        if (!this.#mutationObserver) {\n            this.#mutationObserver = new MutationObserver(() => {\n                this.#render();\n            });\n        }\n        this.#mutationObserver?.disconnect();\n        if (this.observedElements.length > 0) {\n            this.observedElements.forEach(el => {\n                this.#mutationObserver?.observe(el, {\n                    attributes: true,\n                    childList: true,\n                    subtree: true,\n                    characterData: true\n                });\n            });\n        }\n    }\n\n    #render(): void {\n        this.innerHTML = '';\n        const orderedListEl = document.createElement('ol');\n        this.appendChild(orderedListEl);\n        if (this.citationElements.length > 0) {\n            orderedListEl.setAttribute('data-cite-count', this.citationElements.length.toString());\n            const scrollToArgs: ScrollIntoViewOptions = { behavior: 'smooth', block: 'center', inline: 'center' };\n            this.citationElements.forEach(cite => {\n                const listItem = document.createElement('li');\n                orderedListEl.appendChild(listItem);\n                if (this.textOnly) {\n                    listItem.textContent = (cite as HTMLElement).innerText || '';\n                } else {\n                    listItem.innerHTML = (cite.cloneNode(true) as HTMLElement).innerHTML || '';\n                    listItem.querySelectorAll('[id]').forEach(el => {\n                        el.removeAttribute('id'); // Remove IDs to avoid duplicates in the list\n                    });\n                }\n                if (cite.id) {\n                    listItem.setAttribute('data-cite-id', cite.id);\n                }\n                if (this.link) {\n                    listItem.classList.add('cite-link');\n                    listItem.addEventListener(\"click\", () => {\n                        cite.scrollIntoView(scrollToArgs);\n                    });\n                }\n            });\n        }\n        this.dataset.observedElementCount = this.observedElements.length.toString();\n        this.dataset.citeCount = this.citationElements.length.toString();\n    }\n\n    connectedCallback(): void {\n        this.#setupObserver();\n        this.#render();\n    }\n\n    disconnectedCallback(): void {\n        this.#mutationObserver?.disconnect();\n    }\n\n    attributeChangedCallback(name: string, _oldValue: string | null | undefined, _newValue: string | null | undefined): void {\n        if (name === \"selector\") {\n            this.#setupObserver();\n        }\n        this.#render();\n    }\n}\n\nif (customElements && !customElements.get('cite-list')) {\n    customElements.define('cite-list', CiteList);\n}\n\nexport { CiteList };"],"names":["_mutationObserver","_CiteList_instances","setupObserver_fn","render_fn","CiteList","__privateAdd","selector","limit","value","offset","parents","cites","parent","citeEl","__privateMethod","_a","__privateGet","name","_oldValue","_newValue","__privateSet","el","orderedListEl","scrollToArgs","cite","listItem"],"mappings":"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"}