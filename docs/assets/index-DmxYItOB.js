var ee=i=>{throw TypeError(i)};var _=(i,t,e)=>t.has(i)||ee("Cannot "+e);var c=(i,t,e)=>(_(i,t,"read from private field"),e?e.call(i):t.get(i)),w=(i,t,e)=>t.has(i)?ee("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),m=(i,t,e,n)=>(_(i,t,"write to private field"),n?n.call(i,e):t.set(i,e),e),C=(i,t,e)=>(_(i,t,"access private method"),e);class D{diff(t,e,n={}){let s;typeof n=="function"?(s=n,n={}):"callback"in n&&(s=n.callback);const r=this.castInput(t,n),o=this.castInput(e,n),u=this.removeEmpty(this.tokenize(r,n)),l=this.removeEmpty(this.tokenize(o,n));return this.diffWithOptionsObj(u,l,n,s)}diffWithOptionsObj(t,e,n,s){var r;const o=d=>{if(d=this.postProcess(d,n),s){setTimeout(function(){s(d)},0);return}else return d},u=e.length,l=t.length;let a=1,f=u+l;n.maxEditLength!=null&&(f=Math.min(f,n.maxEditLength));const v=(r=n.timeout)!==null&&r!==void 0?r:1/0,p=Date.now()+v,h=[{oldPos:-1,lastComponent:void 0}];let O=this.extractCommon(h[0],e,t,0,n);if(h[0].oldPos+1>=l&&O+1>=u)return o(this.buildValues(h[0].lastComponent,e,t));let B=-1/0,R=1/0;const X=()=>{for(let d=Math.max(B,-a);d<=Math.min(R,a);d+=2){let L;const z=h[d-1],F=h[d+1];z&&(h[d-1]=void 0);let V=!1;if(F){const K=F.oldPos-d;V=F&&0<=K&&K<u}const Y=z&&z.oldPos+1<l;if(!V&&!Y){h[d]=void 0;continue}if(!Y||V&&z.oldPos<F.oldPos?L=this.addToPath(F,!0,!1,0,n):L=this.addToPath(z,!1,!0,1,n),O=this.extractCommon(L,e,t,d,n),L.oldPos+1>=l&&O+1>=u)return o(this.buildValues(L.lastComponent,e,t))||!0;h[d]=L,L.oldPos+1>=l&&(R=Math.min(R,d-1)),O+1>=u&&(B=Math.max(B,d+1))}a++};if(s)(function d(){setTimeout(function(){if(a>f||Date.now()>p)return s(void 0);X()||d()},0)})();else for(;a<=f&&Date.now()<=p;){const d=X();if(d)return d}}addToPath(t,e,n,s,r){const o=t.lastComponent;return o&&!r.oneChangePerToken&&o.added===e&&o.removed===n?{oldPos:t.oldPos+s,lastComponent:{count:o.count+1,added:e,removed:n,previousComponent:o.previousComponent}}:{oldPos:t.oldPos+s,lastComponent:{count:1,added:e,removed:n,previousComponent:o}}}extractCommon(t,e,n,s,r){const o=e.length,u=n.length;let l=t.oldPos,a=l-s,f=0;for(;a+1<o&&l+1<u&&this.equals(n[l+1],e[a+1],r);)a++,l++,f++,r.oneChangePerToken&&(t.lastComponent={count:1,previousComponent:t.lastComponent,added:!1,removed:!1});return f&&!r.oneChangePerToken&&(t.lastComponent={count:f,previousComponent:t.lastComponent,added:!1,removed:!1}),t.oldPos=l,a}equals(t,e,n){return n.comparator?n.comparator(t,e):t===e||!!n.ignoreCase&&t.toLowerCase()===e.toLowerCase()}removeEmpty(t){const e=[];for(let n=0;n<t.length;n++)t[n]&&e.push(t[n]);return e}castInput(t,e){return t}tokenize(t,e){return Array.from(t)}join(t){return t.join("")}postProcess(t,e){return t}get useLongestToken(){return!1}buildValues(t,e,n){const s=[];let r;for(;t;)s.push(t),r=t.previousComponent,delete t.previousComponent,t=r;s.reverse();const o=s.length;let u=0,l=0,a=0;for(;u<o;u++){const f=s[u];if(f.removed)f.value=this.join(n.slice(a,a+f.count)),a+=f.count;else{if(!f.added&&this.useLongestToken){let v=e.slice(l,l+f.count);v=v.map(function(p,h){const O=n[a+h];return O.length>p.length?O:p}),f.value=this.join(v)}else f.value=this.join(e.slice(l,l+f.count));l+=f.count,f.added||(a+=f.count)}}return s}}class he extends D{}const fe=new he;function ae(i,t,e){return fe.diff(i,t,e)}function te(i,t){let e;for(e=0;e<i.length&&e<t.length;e++)if(i[e]!=t[e])return i.slice(0,e);return i.slice(0,e)}function ne(i,t){let e;if(!i||!t||i[i.length-1]!=t[t.length-1])return"";for(e=0;e<i.length&&e<t.length;e++)if(i[i.length-(e+1)]!=t[t.length-(e+1)])return i.slice(-e);return i.slice(-e)}function H(i,t,e){if(i.slice(0,t.length)!=t)throw Error(`string ${JSON.stringify(i)} doesn't start with prefix ${JSON.stringify(t)}; this is a bug`);return e+i.slice(t.length)}function Z(i,t,e){if(!t)return i+e;if(i.slice(-t.length)!=t)throw Error(`string ${JSON.stringify(i)} doesn't end with suffix ${JSON.stringify(t)}; this is a bug`);return i.slice(0,-t.length)+e}function q(i,t){return H(i,t,"")}function j(i,t){return Z(i,t,"")}function ie(i,t){return t.slice(0,de(i,t))}function de(i,t){let e=0;i.length>t.length&&(e=i.length-t.length);let n=t.length;i.length<t.length&&(n=i.length);const s=Array(n);let r=0;s[0]=0;for(let o=1;o<n;o++){for(t[o]==t[r]?s[o]=s[r]:s[o]=r;r>0&&t[o]!=t[r];)r=s[r];t[o]==t[r]&&r++}r=0;for(let o=e;o<i.length;o++){for(;r>0&&i[o]!=t[r];)r=s[r];i[o]==t[r]&&r++}return r}function M(i){let t;for(t=i.length-1;t>=0&&i[t].match(/\s/);t--);return i.substring(t+1)}function S(i){const t=i.match(/^\s*/);return t?t[0]:""}const J="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",ge=new RegExp(`[${J}]+|\\s+|[^${J}]`,"ug");class me extends D{equals(t,e,n){return n.ignoreCase&&(t=t.toLowerCase(),e=e.toLowerCase()),t.trim()===e.trim()}tokenize(t,e={}){let n;if(e.intlSegmenter){const o=e.intlSegmenter;if(o.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');n=Array.from(o.segment(t),u=>u.segment)}else n=t.match(ge)||[];const s=[];let r=null;return n.forEach(o=>{/\s/.test(o)?r==null?s.push(o):s.push(s.pop()+o):r!=null&&/\s/.test(r)?s[s.length-1]==r?s.push(s.pop()+o):s.push(r+o):s.push(o),r=o}),s}join(t){return t.map((e,n)=>n==0?e:e.replace(/^\s+/,"")).join("")}postProcess(t,e){if(!t||e.oneChangePerToken)return t;let n=null,s=null,r=null;return t.forEach(o=>{o.added?s=o:o.removed?r=o:((s||r)&&se(n,r,s,o),n=o,s=null,r=null)}),(s||r)&&se(n,r,s,null),t}}const pe=new me;function oe(i,t,e){return(e==null?void 0:e.ignoreWhitespace)!=null&&!e.ignoreWhitespace?le(i,t,e):pe.diff(i,t,e)}function se(i,t,e,n){if(t&&e){const s=S(t.value),r=M(t.value),o=S(e.value),u=M(e.value);if(i){const l=te(s,o);i.value=Z(i.value,o,l),t.value=q(t.value,l),e.value=q(e.value,l)}if(n){const l=ne(r,u);n.value=H(n.value,u,l),t.value=j(t.value,l),e.value=j(e.value,l)}}else if(e){if(i){const s=S(e.value);e.value=e.value.substring(s.length)}if(n){const s=S(n.value);n.value=n.value.substring(s.length)}}else if(i&&n){const s=S(n.value),r=S(t.value),o=M(t.value),u=te(s,r);t.value=q(t.value,u);const l=ne(q(s,u),o);t.value=j(t.value,l),n.value=H(n.value,s,l),i.value=Z(i.value,s,s.slice(0,s.length-l.length))}else if(n){const s=S(n.value),r=M(t.value),o=ie(r,s);t.value=j(t.value,o)}else if(i){const s=M(i.value),r=S(t.value),o=ie(s,r);t.value=q(t.value,o)}}class ve extends D{tokenize(t){const e=new RegExp(`(\\r?\\n)|[${J}]+|[^\\S\\n\\r]+|[^${J}]`,"ug");return t.match(e)||[]}}const Ce=new ve;function le(i,t,e){return Ce.diff(i,t,e)}class Ae extends D{constructor(){super(...arguments),this.tokenize=ue}equals(t,e,n){return n.ignoreWhitespace?((!n.newlineIsToken||!t.includes(`
`))&&(t=t.trim()),(!n.newlineIsToken||!e.includes(`
`))&&(e=e.trim())):n.ignoreNewlineAtEof&&!n.newlineIsToken&&(t.endsWith(`
`)&&(t=t.slice(0,-1)),e.endsWith(`
`)&&(e=e.slice(0,-1))),super.equals(t,e,n)}}const we=new Ae;function be(i,t,e){return we.diff(i,t,e)}function ue(i,t){t.stripTrailingCr&&(i=i.replace(/\r\n/g,`
`));const e=[],n=i.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(let s=0;s<n.length;s++){const r=n[s];s%2&&!t.newlineIsToken?e[e.length-1]+=r:e.push(r)}return e}function xe(i){return i=="."||i=="!"||i=="?"}class Ee extends D{tokenize(t){var e;const n=[];let s=0;for(let r=0;r<t.length;r++){if(r==t.length-1){n.push(t.slice(s));break}if(xe(t[r])&&t[r+1].match(/\s/)){for(n.push(t.slice(s,r+1)),r=s=r+1;!((e=t[r+1])===null||e===void 0)&&e.match(/\s/);)r++;n.push(t.slice(s,r+1)),s=r+1}}return n}}const Pe=new Ee;function Se(i,t,e){return Pe.diff(i,t,e)}class ye extends D{tokenize(t){return t.split(/([{}:;,]|\s+)/)}}const We=new ye;function De(i,t,e){return We.diff(i,t,e)}class Oe extends D{constructor(){super(...arguments),this.tokenize=ue}get useLongestToken(){return!0}castInput(t,e){const{undefinedReplacement:n,stringifyReplacer:s=(r,o)=>typeof o>"u"?n:o}=e;return typeof t=="string"?t:JSON.stringify(G(t,null,null,s),null,"  ")}equals(t,e,n){return super.equals(t.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"),n)}}const Le=new Oe;function Ie(i,t,e){return Le.diff(i,t,e)}function G(i,t,e,n,s){t=t||[],e=e||[],n&&(i=n(s===void 0?"":s,i));let r;for(r=0;r<t.length;r+=1)if(t[r]===i)return e[r];let o;if(Object.prototype.toString.call(i)==="[object Array]"){for(t.push(i),o=new Array(i.length),e.push(o),r=0;r<i.length;r+=1)o[r]=G(i[r],t,e,n,String(r));return t.pop(),e.pop(),o}if(i&&i.toJSON&&(i=i.toJSON()),typeof i=="object"&&i!==null){t.push(i),o={},e.push(o);const u=[];let l;for(l in i)Object.prototype.hasOwnProperty.call(i,l)&&u.push(l);for(u.sort(),r=0;r<u.length;r+=1)l=u[r],o[l]=G(i[l],t,e,n,l);t.pop(),e.pop()}else o=i;return o}class Ne extends D{tokenize(t){return t.slice()}join(t){return t}removeEmpty(t){return t}}const Te=new Ne;function ze(i,t,e){return Te.diff(i,t,e)}const re={word:oe,chars:ae,wordsWithSpaces:le,lines:be,sentences:Se,css:De,json:Ie,arrays:ze};var x,E,A,y,W,P,N,T,g,U,I,k,ce,b;const $=class $ extends HTMLElement{constructor(){super();w(this,g);w(this,x,null);w(this,E,null);w(this,A,null);w(this,y);w(this,W);w(this,P,[]);w(this,N,null);w(this,T,null);w(this,I,e=>{const n=e.innerText,s=this.compare;if(!(s!=null&&s.length))return n;const r=s in e?e[s]:null;if(s)return r;const o=e.getAttribute(s);return o||r||o||n})}static get setupAttrs(){return["original","changed","original-src","changed-src","refetch"]}static get observedAttributes(){return[...["mode","ignore-case"],...$.setupAttrs,"compare"]}get changes(){return c(this,P)}get mode(){return this.getAttribute("mode")||"word"}set mode(e){e!=null&&e.length?this.removeAttribute("mode"):this.setAttribute("mode",e)}get ignoreCase(){return this.getAttribute("ignore-case")==="true"}set ignoreCase(e){e?this.setAttribute("ignore-case",""):this.removeAttribute("ignore-case")}get original(){return this.getAttribute("original")||""}set original(e){e!=null&&e.length?this.setAttribute("original",e):this.removeAttribute("original")}get changed(){return this.getAttribute("changed")||""}set changed(e){e!=null&&e.length?this.setAttribute("changed",e):this.removeAttribute("changed")}get originalSrc(){return this.getAttribute("original-src")||""}set originalSrc(e){e!=null&&e.length?this.setAttribute("original-src",e):this.removeAttribute("original-src")}get changedSrc(){return this.getAttribute("changed-src")||""}set changedSrc(e){e!=null&&e.length?this.setAttribute("changed-src",e):this.removeAttribute("changed-src")}get refetch(){const e=this.getAttribute("refetch");if(e){const n=parseInt(e,10);return isNaN(n)||n<=0?void 0:n}}set refetch(e){if(e!=null&&e.length)try{parseInt(e,10)?this.setAttribute("refetch",e):this.removeAttribute("refetch")}catch{this.removeAttribute("refetch")}else this.removeAttribute("refetch")}get compare(){return this.getAttribute("compare")}set compare(e){e!=null&&e.length?this.setAttribute("compare",e):this.removeAttribute("compare")}connectedCallback(){C(this,g,k).call(this),C(this,g,b).call(this)}disconnectedCallback(){var e,n;(e=c(this,x))==null||e.disconnect(),m(this,x,null),(n=c(this,E))==null||n.disconnect(),m(this,E,null),c(this,A)&&(clearInterval(c(this,A)),m(this,A,null))}get options(){return c(this,T)||void 0}set options(e){e?m(this,T,e):m(this,T,null),C(this,g,b).call(this)}attributeChangedCallback(e,n,s){if(e==="mode"&&(s!=null&&s.length)&&!re[s]){this.setAttribute("mode","word");return}$.setupAttrs.includes(e)&&C(this,g,k).call(this),C(this,g,b).call(this)}refresh(){C(this,g,k).call(this),C(this,g,b).call(this)}};x=new WeakMap,E=new WeakMap,A=new WeakMap,y=new WeakMap,W=new WeakMap,P=new WeakMap,N=new WeakMap,T=new WeakMap,g=new WeakSet,U=function(){const e=this.getAttribute("original-src"),n=this.getAttribute("changed-src"),s=[],r=[];e&&s.push(fetch(e).then(o=>this.mode==="json"?o.json():o.text()).then(o=>{m(this,y,o)}).catch(o=>r.push(o))),n&&s.push(fetch(n).then(o=>this.mode==="json"?o.json():o.text()).then(o=>{m(this,W,o)}).catch(o=>r.push(o))),Promise.allSettled(s).then(()=>{r.length&&(console.error("Error fetching diff text sources:"),r.forEach(o=>console.error(o))),C(this,g,b).call(this)})},I=new WeakMap,k=function(){var f,v;this.disconnectedCallback();const e=!!this.getAttribute("original-src"),n=!!this.getAttribute("changed-src"),s=this.getAttribute("refetch"),r=s?parseInt(s,10):0,o=(e||n)&&!!r,u=!e&&!!this.original,l=!n&&!!this.changed;(e||n)&&C(this,g,U).call(this),o&&(c(this,A)&&clearInterval(c(this,A)),c(this,A)&&(clearInterval(c(this,A)),m(this,A,null)),m(this,A,setInterval(()=>{C(this,g,U).call(this),C(this,g,b).call(this)},Math.max(1e3,r*1e3))));const a={childList:!0,subtree:!0,attributes:!0,characterData:!0};if(u){const p=this.getAttribute("original");if(c(this,x)?c(this,x).disconnect():this.original&&m(this,x,new MutationObserver(()=>{const h=document.querySelector(this.original);m(this,y,c(this,I).call(this,h)),C(this,g,b).call(this)})),p){const h=document.querySelector(p);h&&((f=c(this,x))==null||f.observe(h,a),m(this,y,c(this,I).call(this,h)))}}if(l){const p=this.getAttribute("changed");if(c(this,E)?c(this,E).disconnect():this.changed&&m(this,E,new MutationObserver(()=>{const h=document.querySelector(this.changed);m(this,W,c(this,I).call(this,h)),C(this,g,b).call(this)})),p){const h=document.querySelector(p);h&&((v=c(this,E))==null||v.observe(h,a),m(this,W,c(this,I).call(this,h)))}}},ce=function(){var l,a,f;const e=re[this.mode]||oe,n=c(this,y),s=c(this,W),r=structuredClone(c(this,P)),o=e(n??"",s??"",{ignoreCase:!!this.ignoreCase,...this.options??{},callback:void 0}),u=o.length!==r.length||o.some((v,p)=>{const h=r[p];return!h||v.value!==h.value||v.added!==h.added||v.removed!==h.removed||v.count!==h.count});if(u){m(this,P,o),this.options&&((l=this.options)!=null&&l.callback)&&typeof((a=this.options)==null?void 0:a.callback)=="function"&&((f=this.options)==null||f.callback(c(this,P)));const v={...Object.fromEntries($.observedAttributes.map(p=>[p,this.getAttribute(p)])),options:this.options,original:c(this,y),changed:c(this,W),changes:c(this,P)};this.dispatchEvent(new CustomEvent("diff-text",{detail:v,bubbles:!0,composed:!0,cancelable:!0}))}return u},b=function(){c(this,N)&&cancelAnimationFrame(c(this,N)),m(this,N,requestAnimationFrame(()=>{C(this,g,ce).call(this)&&(this.innerHTML="",c(this,P).forEach(n=>{const s=document.createElement("span");s.textContent=n.value,n.added?s.classList.add("diff-text-added"):n.removed&&s.classList.add("diff-text-removed"),s.dataset.diffTextCount=n.count.toString(),this.appendChild(s)}))}))};let Q=$;customElements&&(customElements!=null&&customElements.define)&&customElements.define("diff-text",Q);export{Q as DiffText};
//# sourceMappingURL=index-DmxYItOB.js.map
