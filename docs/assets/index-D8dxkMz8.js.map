{"version":3,"file":"index-D8dxkMz8.js","sources":["../../packages/capture-dom/index.ts"],"sourcesContent":["/**\n * Captures child DOM elements for use in \n */\nexport class CaptureDOM extends HTMLElement {\n    /**\n     * @type {string[]} \n     */\n    static get observedAttributes(): string[] {\n        return ['element', 'file', 'mode', 'exportparts', 'audio', 'download', 'controlled', 'autoplay', 'background-color'];\n    }\n\n    #stream: MediaStream | null = null;\n\n    #chunks: Blob[] = [];\n\n    #mediaRecorder: MediaRecorder | null = null;\n\n    #error: Error | null = null;\n\n    #errorHandler(err: Error | null | undefined): void {\n        if (err) {\n            this.stopCapture();\n            console.error(err);\n            this.#error = err;\n            this.#emitEvent('error');\n            if (!this.controlled && (!this.shadowRoot || !this.shadowRoot.querySelector('#error'))) {\n                this.#render();\n            }\n        }\n        if (!this.controlled) {\n            const errorEl = this.shadowRoot?.querySelector('#error');\n            if (errorEl) {\n                errorEl.textContent = err ? err.message ? err.message : JSON.stringify(err) : '';\n            }\n        }\n    }\n\n    #opfsHandle: FileSystemFileHandle | null = null;\n\n    get #fileName(): string {\n        return this.file ?? `${this.id ? `${this.id}-` : ''}${new Date().toISOString().replaceAll(\":\", \"-\")}.webm`;\n    }\n\n    async #setupOPFSHandle(): Promise<void> {\n        if (!this.#opfsHandle || this.#opfsHandle.name !== this.#fileName) {\n            const root = await navigator.storage.getDirectory();\n            /**\n             * @type {FileSystemFileHandle}\n             */\n            const draftHandle = await root.getFileHandle(this.#fileName, { create: true });\n            this.#opfsHandle = draftHandle;\n        }\n    }\n\n    #render(): void {\n        try {\n            if (!this.shadowRoot) {\n                this.attachShadow({ mode: 'open' });\n            }\n            if (this.shadowRoot) {\n                const template = this.querySelector('template');\n                const downloadHtml = this.download ? `<a id=\"download\" download href=\"\" file=\"${this.#fileName}\"><slot name=\"download\" part=\"download\"></slot></a>` : '';\n                if (template) {\n                    this.shadowRoot.innerHTML = (template.content.cloneNode(true) as HTMLElement).outerHTML;\n                    if (!this.controlled) {\n                        //if the template is missing control or target elements, add them. \n                        //The error element is optional in case consumers don't want to render it.\n                        if (!this.shadowRoot.querySelector('#controls')) {\n                            this.shadowRoot.innerHTML = `<div id=\"controls\" part=\"controls\"></div>` + this.shadowRoot.innerHTML;\n                        }\n                        if (!this.shadowRoot.querySelector('#target')) {\n                            this.shadowRoot.innerHTML += `<div id=\"target\" part=\"target\"><slot></slot></div>`;\n                        }\n\n                        if (this.download && !this.shadowRoot.querySelector(\"#download\")) {\n                            this.querySelector('#controls')!.innerHTML += downloadHtml;\n                        }\n                    }\n                } else {\n                    if (this.controlled) {\n                        this.shadowRoot.innerHTML = `<div id=\"target\" part=\"target\"><slot></slot></div>`;\n                    } else {\n                        this.shadowRoot.innerHTML = `\n                        <div id=\"controls\" part=\"controls\">\n                            <button id=\"start\"><slot name=\"start\"></slot></button>\n                            <button id=\"stop\"><slot name=\"stop\"></slot></button>\n                            ${downloadHtml}\n                        </div>\n                        <div id=\"error\" part=\"error\"></div>\n                        <div id=\"target\" part=\"target\"><slot></slot></div>`;\n                    }\n                }\n\n                if (!this.controlled && !this.shadowRoot.querySelector('#start')) {\n                    const startButton = document.createElement('button');\n                    startButton.id = 'start';\n                    startButton.textContent = 'Start';\n                    this.shadowRoot.querySelector('#controls')!.appendChild(startButton);\n                }\n\n                if (!this.controlled && !this.shadowRoot.querySelector('#stop')) {\n                    const stopButton = document.createElement('button');\n                    stopButton.id = 'stop';\n                    stopButton.textContent = 'Stop';\n                    this.shadowRoot.querySelector('#controls')!.appendChild(stopButton);\n                }\n\n                if (!this.controlled && this.download && !this.shadowRoot.querySelector('#download')) {\n                    const downloadButton = document.createElement('button');\n                    downloadButton.id = 'download';\n                    downloadButton.textContent = 'Download';\n                    this.shadowRoot.querySelector('#controls')!.appendChild(downloadButton);\n                }\n\n                if (!this.controlled) {\n                    this.shadowRoot.querySelector('#start')?.addEventListener('click', this.startCapture.bind(this));\n                    this.shadowRoot.querySelector('#stop')?.addEventListener('click', this.stopCapture.bind(this));\n\n                    if (this.download) {\n                        this.shadowRoot.querySelector('#download')?.addEventListener('click', this.downloadCapture.bind(this));\n                    }\n\n                    if (this.#error && this.shadowRoot.querySelector('#error')) {\n                        this.shadowRoot.querySelector('#error')!.textContent = this.#error.message ? this.#error.message : 'An error occurred during capture.';\n                    }\n                }\n\n                // these ensure the target is eligible for restriction.\n                // A default background color can be inherited from the element if needed.\n                const targetEl: HTMLElement | null = this.shadowRoot?.querySelector(\"#target\") ?? null;\n                if (targetEl) {\n                    targetEl.style.isolation = \"isolate\";\n                    targetEl.style.transformStyle = \"flatten\";\n                    targetEl.style.backgroundColor = this.backgroundColor ?? \"white\"; // Ensure the target has a background color\n                }\n            }\n        } catch (err) {\n            this.#errorHandler(err);\n        }\n    }\n\n    get element(): string | null {\n        return this.getAttribute('element');\n    }\n\n    set element(selector: string | null | undefined) {\n        if (selector?.length) {\n            this.setAttribute('output-element', selector);\n        } else {\n            this.removeAttribute('output-element');\n        }\n    }\n\n    get file(): string | null {\n        return this.getAttribute('file');\n    }\n\n    set file(value: string | null | undefined) {\n        if (value?.length) {\n            this.setAttribute('file', value);\n        } else {\n            this.removeAttribute('file');\n        }\n    }\n\n    get mode(): string | null {\n        const explicit = this.getAttribute('mode');\n        if (explicit) {\n            return explicit;\n        }\n        if (this.element) return 'element';\n        return null;\n    }\n\n    /**\n     * Explicitly sets the mode of the capture.\n     */\n    set mode(value: \"element\" | \"opfs\" | \"none\" | null | undefined) {\n        if (!value || value === 'none') {\n            this.removeAttribute('mode');\n        } else {\n            const validModes = ['element', 'opfs', 'none'];\n            if (!validModes.includes(value)) {\n                this.#errorHandler(new Error(`Invalid mode: ${value}. Valid modes are ${validModes.sort().join(\", \")}.`));\n            }\n        }\n    }\n\n    get download(): boolean {\n        return this.hasAttribute('download');\n    }\n\n    set download(value: boolean | null | undefined) {\n        if (value) {\n            this.setAttribute('download', '');\n        } else {\n            this.removeAttribute('download');\n        }\n    }\n\n    get controlled(): boolean {\n        return this.hasAttribute('controlled');\n    }\n\n    set controlled(value: boolean | null | undefined) {\n        if (value) {\n            this.setAttribute('controlled', '');\n        } else {\n            this.removeAttribute('controlled');\n        }\n    }\n\n    get error(): Error | null {\n        return this.#error;\n    }\n\n    get blob(): Blob | null {\n        return this.#chunks.length ? new Blob(this.#chunks, { type: 'video/webm' }) : null;\n    }\n\n    get captureUrl(): string | null {\n        const blob = this.blob;\n        if (blob) {\n            return URL.createObjectURL(blob);\n        }\n        return null;\n    }\n\n    get track(): MediaStreamTrack | null {\n        return this.#stream?.getVideoTracks()[0] || null;\n    }\n\n    get autoplay(): boolean {\n        return this.hasAttribute('autoplay');\n    }\n\n    set autoplay(value: boolean | null | undefined) {\n        if (value) {\n            this.setAttribute('autoplay', '');\n        } else {\n            this.removeAttribute('autoplay');\n        }\n    }\n\n    get backgroundColor(): string {\n        return this.getAttribute('background-color') || 'white';\n    }\n\n    set backgroundColor(value: string | null | undefined) {\n        if (value) {\n            this.setAttribute('background-color', value);\n        } else {\n            this.removeAttribute('background-color');\n        }\n    }\n\n    get audio(): boolean {\n        return this.hasAttribute('audio');\n    }\n\n    set audio(value: boolean | null | undefined) {\n        if (value) {\n            this.setAttribute('audio', '');\n        } else {\n            this.removeAttribute('audio');\n        }\n    }\n\n    /**\n     * Emits a custom event with the given name and handles extra details.\n     */\n    #emitEvent(name: \"started\" | \"stopped\" | \"error\" | \"download\"): void {\n        const eventName = `capture-dom-${name}`;\n        const standardOptions = { bubbles: true, cancelable: false, composed: true };\n        const standardDetail = { mode: this.mode, file: this.file, element: this.element };\n        const dispatch = (extraDetail?: object) => {\n            const evt = new CustomEvent(eventName, { ...standardOptions, detail: { ...standardDetail, ...extraDetail } });\n            this.dispatchEvent(evt);\n        };\n        switch (name) {\n            case 'error':\n                dispatch({ error: this.#error });\n                break;\n            case 'stopped':\n            case 'download':\n                dispatch({ blob: this.blob, url: this.blob ? URL.createObjectURL(this.blob) : '' });\n                break;\n            case 'started':\n            default:\n                dispatch();\n                break;\n        }\n    }\n\n    /**\n     * Starts the capture of the DOM element.\n     * @returns {Promise<void>}\n     */\n    startCapture = async (): Promise<void> => {\n        this.stopCapture();\n        if (!this.isConnected) return;\n        this.#errorHandler(null);\n        /**\n         * @type {MediaStreamConstraints}\n         * @see https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getDisplayMedia\n         */\n        const displayMediaOptions = {\n            video: {\n                displaySurface: \"window\",\n                // monitorTypeSurfaces: \"exclude\",\n                // selfBrowserSurface: \"exclude\",\n                autoGainControl: false,\n                suppressLocalAudioPlayback: false,\n                // sampleRate: 44100,\n                // sampleSize: 16,\n            },\n            audio: this.hasAttribute('audio'),\n            surfaceSwitching: \"exclude\",\n            systemAudio: this.hasAttribute('audio') ? \"include\" : \"exclude\",\n            preferCurrentTab: true,\n        };\n        try {\n            this.#stream =\n                await navigator.mediaDevices.getDisplayMedia(displayMediaOptions);\n            const targetEl = this.shadowRoot!.querySelector('#target');\n            console.log('target Element', targetEl, this.shadowRoot);\n            if (!targetEl) {\n                throw new Error('No target element found. capture-dom requires a target with ID \"target\".');\n            }\n            const restrictionTarget = await RestrictionTarget.fromElement(this.shadowRoot.querySelector('#target'));\n            if (!restrictionTarget) {\n                throw new Error('No restriction target found. capture-dom requires a target with ID \"target\".');\n            }\n            console.log(this.#stream, this.track);\n            await this.track?.restrictTo(restrictionTarget);\n            switch (this.mode) {\n                case 'element': {\n                    if (!this.element) {\n                        throw new Error('Element mode requires an \"element\" attribute to be set.');\n                    }\n                    if (!document.querySelector(this.element)) {\n                        throw new Error(`No element found for selector: ${this.element}`);\n                    } else {\n                        const targetElement = document.querySelector(this.element);\n                        if (targetElement instanceof HTMLVideoElement || targetElement instanceof HTMLAudioElement) {\n                            targetElement.srcObject = this.#stream;\n                            if (this.autoplay) {\n                                targetElement.play();\n                            }\n                            if (this.audio) {\n                                targetElement.muted = true; // Ensure audio is muted when capturing to avoid a feedback loop\n                            }\n                        } else {\n                            throw new Error(`The element for selector \"${this.element}\" is not a video or audio element.`);\n                        }\n                    }\n                }\n                case 'opfs': {\n                    if (!this.#opfsHandle) {\n                        await this.#setupOPFSHandle();\n                    }\n                    break;\n                }\n                case null: {\n                    //do nothing if there is no mode set\n                    break;\n                }\n                default:\n                    throw new Error(`Invalid mode: ${this.mode}.`);\n            }\n            if (this.#mediaRecorder) {\n                this.#mediaRecorder.stop();\n                this.#mediaRecorder = null;\n            }\n            this.#chunks = [];\n            this.#mediaRecorder = new MediaRecorder(this.#stream, { mimeType: 'video/webm' });\n            this.#mediaRecorder.addEventListener(\"dataavailable\", ((e) => {\n                this.#chunks.push(e.data);\n                //we can write to the OPFS file as the stream is created\n                if (this.mode === 'opfs' && this.#opfsHandle) {\n                    this.#opfsHandle.write(e.data);\n                }\n                if (this.download) {\n                    const downloadLink = (this.shadowRoot?.querySelector('#download') ?? null) as HTMLAnchorElement | null;\n                    if (downloadLink) {\n                        downloadLink.href = URL.createObjectURL(e.data);\n                        downloadLink.download = this.#fileName;\n                    }\n                }\n            }).bind(this));\n            this.#mediaRecorder.addEventListener(\"stop\", ((evt) => {\n                if (this.element) {\n                    const url = this.blob ? URL.createObjectURL(this.blob) : '';\n                    const targetElement = document.querySelector(this.element);\n                    if (targetElement instanceof HTMLVideoElement || targetElement instanceof HTMLAudioElement) {\n                        targetElement.srcObject = null; // Clear the previous stream\n                        targetElement.src = url; // Set the new blob URL\n                        this.#emitEvent('stopped');\n                    }\n                } else {\n                    this.#emitEvent('stopped');\n                }\n            }).bind(this));\n            this.#mediaRecorder.addEventListener(\"error\", this.#errorHandler.bind(this));\n            this.setAttribute('recording', '');\n            this.#mediaRecorder.start();\n            this.#emitEvent('started');\n        } catch (err) {\n            this.#errorHandler(err);\n        }\n    }\n\n    /**\n     * Stops the capture and releases the media stream.\n     */\n    stopCapture = async (): Promise<void> => {\n        this.removeAttribute('recording');\n        if (this.#stream) {\n            this.#stream.getTracks().forEach(track => track.stop());\n            this.#stream = null;\n        }\n        if (this.#mediaRecorder) {\n            this.#mediaRecorder.stop();\n            this.#mediaRecorder = null;\n        }\n        if (this.#opfsHandle) {\n            this.#opfsHandle = null;\n        }\n    }\n\n    downloadCapture(): void {\n        try {\n            if (!this.blob) {\n                this.#errorHandler(new Error('No capture data available to download.'));\n            } else {\n                this.#emitEvent('download');\n            }\n        } catch (err) {\n            this.#errorHandler(err);\n        }\n    }\n\n    connectedCallback(): void {\n        this.#render();\n    }\n\n    disconnectedCallback(): void {\n        this.stopCapture();\n    }\n\n    attributeChangedCallback(name: string, _oldValue: string, newValue: string): void {\n        const exportParts = [\"controls\", \"start\", \"stop\", \"target\", \"error\"];\n        if (name === 'exportparts' && newValue !== exportParts.sort().join(',')) {\n            this.setAttribute('exportparts', exportParts.sort().join(','));\n        } else {\n            this.stopCapture();\n            this.#render();\n        }\n    }\n}\n\nif (customElements && !customElements.get('capture-dom')) {\n    customElements.define('capture-dom', CaptureDOM);\n}"],"names":["_stream","_chunks","_mediaRecorder","_error","_CaptureDOM_instances","errorHandler_fn","_opfsHandle","fileName_get","setupOPFSHandle_fn","render_fn","emitEvent_fn","CaptureDOM","__privateAdd","__privateSet","_a","__privateMethod","displayMediaOptions","targetEl","restrictionTarget","__privateGet","targetElement","e","downloadLink","evt","url","err","track","selector","value","explicit","validModes","blob","name","_oldValue","newValue","exportParts","errorEl","draftHandle","_b","_c","_d","template","downloadHtml","startButton","stopButton","downloadButton","eventName","standardOptions","standardDetail","dispatch","extraDetail"],"mappings":"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"}